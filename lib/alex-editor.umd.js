!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["alex-editor"]={})}(this,(function(e){"use strict";var t=Object.defineProperty,n=(e,n,s)=>(((e,n,s)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s})(e,"symbol"!=typeof n?n+"":n,s),s);const s={formatNumber(e){return this.isNumber(e)?e.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):e},isNumber:e=>"number"==typeof e&&!isNaN(e),add:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,i=0;try{n=e.toString().split(".")[1].length}catch(r){}try{s=t.toString().split(".")[1].length}catch(r){}return i=Math.pow(10,Math.max(n,s)),(e*i+t*i)/i})),subtract:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,i=0;try{n=e.toString().split(".")[1].length}catch(r){}try{s=t.toString().split(".")[1].length}catch(r){}return i=Math.pow(10,Math.max(n,s)),(e*i-t*i)/i})),mutiply:(...e)=>e.reduce(((e,t)=>{let n=0,s=e.toString(),i=t.toString();try{n+=s.split(".")[1].length}catch(r){}try{n+=i.split(".")[1].length}catch(r){}return Number(s.replace(".",""))*Number(i.replace(".",""))/Math.pow(10,n)})),divide:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,i=e.toString(),r=t.toString();try{n=i.split(".")[1].length}catch(o){}try{s=r.split(".")[1].length}catch(o){}return i=Number(i.replace(".","")),r=Number(r.replace(".","")),i/r*Math.pow(10,s-n)}))},i={insert(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if("string"!=typeof t)throw new TypeError("The second argument must be a string");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,n)+t+e.substring(n,e.length)},delete(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!s.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,t)+e.substring(t+n,e.length)},replace(e,t,n,i){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!s.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");if("string"!=typeof i)throw new TypeError("The fourth argument must be a string");return e.substring(0,t)+i+e.substring(n,e.length)},trim(e,t=!1){if("string"!=typeof e)throw new TypeError("The first argument must be a string");let n=e.replace(/(^\s+)|(\s+$)/g,"");return t&&(n=n.replace(/\s/g,"")),n}},r={isWindow:e=>e&&e instanceof Window,getElementPoint(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(this.isElement(t)||(t=document.body),!this.isContains(t,e))throw new Error("The second argument and the first argument have no hierarchical relationship");let n=e,s=0,i=0;for(;this.isElement(e)&&this.isContains(t,e)&&t!==e;)s+=e.offsetTop,i+=e.offsetLeft,e=e.offsetParent;return{top:s,left:i,right:t.offsetWidth-i-n.offsetWidth,bottom:t.offsetHeight-s-n.offsetHeight}},isContains(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t))throw new TypeError("The second argument must be an element");return e===t||(e.contains?e.contains(t):e.compareDocumentPosition?!!(16&e.compareDocumentPosition(t)):void 0)},isParentNode(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t))throw new TypeError("The second argument must be an element");return e!==t&&t.parentNode===e},children(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");return[...e.querySelectorAll(t||"*")].filter((t=>t.parentNode===e))},siblings(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!e.parentNode)return[];return[...e.parentNode.querySelectorAll(t||"*")].filter((t=>t.parentNode===e.parentNode&&t!=e))},rem2px(e){if(!s.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return s.mutiply(e,parseFloat(t))},px2rem(e){if(!s.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return s.divide(e,parseFloat(t))},width(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientWidth,n=parseFloat(this.getCssStyle(e,"padding-left")),i=parseFloat(this.getCssStyle(e,"padding-right"));return s.subtract(t,n,i)},height(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientHeight,n=parseFloat(this.getCssStyle(e,"padding-top")),i=parseFloat(this.getCssStyle(e,"padding-bottom"));return s.subtract(t,n,i)},removeClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;i.trim(t).split(/\s+/).forEach((e=>{n.remove(e)}))},addClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;i.trim(t).split(/\s+/).forEach((e=>{n.add(e)}))},hasClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;return i.trim(t).split(/\s+/).every((e=>n.contains(e)))},scrollTopBottomTrigger(e,t){"string"==typeof e&&e&&(e=document.body.querySelector(e));let n=window;this.isElement(e)&&e!=document.body&&e!=document.documentElement&&(n=e),"function"==typeof e&&(t=e);let i=!0;n.addEventListener("scroll",(e=>{if(this.getScrollTop(n)<=0){if(!i)return;"function"==typeof t&&(i=!1,t({state:"top",target:n}))}else{let e={state:"bottom",target:n},r=0;if(r=n==window?window.innerHeight:n.clientHeight,s.add(this.getScrollTop(n),r)+1>=this.getScrollHeight(n)&&r!=this.getScrollHeight(n)){if(!i)return;"function"==typeof t&&(i=!1,t(e))}else i=!0}}))},getScrollWidth(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollWidth:0==document.documentElement.scrollWidth||0==document.body.scrollWidth?document.documentElement.scrollWidth||document.body.scrollWidth:document.documentElement.scrollWidth>document.body.scrollWidth?document.documentElement.scrollWidth:document.body.scrollWidth,t},getScrollHeight(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollHeight:0==document.documentElement.scrollHeight||0==document.body.scrollHeight?document.documentElement.scrollHeight||document.body.scrollHeight:document.documentElement.scrollHeight>document.body.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight,t},setScrollTop(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let i=e.number||0,r=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise(((e,o)=>{if(r<=0)t?document.documentElement.scrollTop=document.body.scrollTop=i:n.scrollTop=i,e();else{let o=10,l=s.divide(r,o),a=this.getScrollTop(n),h=s.divide(s.subtract(i,a),l),c=setInterval((()=>{l>0?(l--,t?document.documentElement.scrollTop=document.body.scrollTop=a=s.add(a,h):n.scrollTop=a=s.add(a,h)):(clearInterval(c),e())}),o)}}))},getScrollTop(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollTop:0==document.documentElement.scrollTop||0==document.body.scrollTop?document.documentElement.scrollTop||document.body.scrollTop:document.documentElement.scrollTop>document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,t},getScrollLeft(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollLeft:0==document.documentElement.scrollLeft||0==document.body.scrollLeft?document.documentElement.scrollLeft||document.body.scrollLeft:document.documentElement.scrollLeft>document.body.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,t},setScrollLeft(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let i=e.number||0,r=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise(((e,o)=>{if(r<=0)t?document.documentElement.scrollLeft=document.body.scrollLeft=i:n.scrollLeft=i,e();else{let o=10,l=s.divide(r,o),a=this.getScrollLeft(n),h=s.divide(s.subtract(i,a),l),c=setInterval((()=>{l>0?(l--,t?document.documentElement.scrollLeft=document.body.scrollLeft=a=s.add(a,h):n.scrollLeft=a=s.add(a,h)):(clearInterval(c),e())}),o)}}))},getCssStyle(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n="";return n=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e)[t]:e.currentStyle[t],n},getCssSelector(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a selector string");if(/^#{1}/.test(e))return{type:"id",value:e.substr(1)};if(/^\./.test(e))return{type:"class",value:e.substr(1)};if(/^\[(.+)\]$/.test(e)){let t="attribute",n="",s=i.trim(e,!0).substring(1,i.trim(e,!0).length-1).split("=");return 1==s.length&&(n=s[0]),2==s.length&&(n={attributeName:s[0],attributeValue:s[1].replace(/\'/g,"").replace(/\"/g,"")}),{type:t,value:n}}return{type:"tag",value:e}},getElementBounding(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.getBoundingClientRect();return{top:t.top,bottom:s.subtract(document.documentElement.clientHeight||window.innerHeight,t.bottom),left:t.left,right:s.subtract(document.documentElement.clientWidth||window.innerWidth,t.right)}},isElement:e=>e&&e instanceof Node&&1===e.nodeType,string2dom(e,t="div"){if(!e||"string"!=typeof e)throw new TypeError("The argument must be an HTML string");let n=document.createElement(t);return n.innerHTML=e,1==n.children.length?n.children[0]:Array.from(n.children)}},o="_dap-datas",l={remove(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[o]||{};null==t||""===t?e[o]={}:(delete n[t],e[o]=n)},has(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");return(e[o]||{}).hasOwnProperty(t)},get(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[o]||{};return null==t||""===t?n:n[t]},set(e,t,n){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");let s=e[o]||{};s[t]=n,e[o]=s}},a={matchingText(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=null;if("Chinese"==t&&(n=/^[\u4e00-\u9fa5]+$/),"chinese"==t&&(n=/[\u4e00-\u9fa5]/),"email"==t&&(n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/),"username"==t&&(n=/^[a-zA-Z0-9_]{4,16}$/),"int+"==t&&(n=/^\d+$/),"int-"==t&&(n=/^-\d+$/),"int"==t&&(n=/^-?\d+$/),"pos"==t&&(n=/^\d*\.?\d+$/),"neg"==t&&(n=/^-\d*\.?\d+$/),"number"==t&&(n=/^-?\d*\.?\d+$/),"phone"==t&&(n=/^1[0-9]\d{9}$/),"idCard"==t&&(n=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/),"url"==t&&(n=/^((https?|ftp|file):\/\/)?([\da-z\.-]+)\.([\da-z\.]{2,6})([\/\w \.-]*)*\/?$/),"IPv4"==t&&(n=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/),"hex"==t&&(n=/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/),"rgb"==t&&(n=/^rgb\((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d)\)$/),"rgba"==t&&(n=/^rgba\((25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(25[0-5]|2[0-4]\d|1\d{2}|[1-9]\d|\d),\s?(0?\.\d|1(\.0)?|0)\)$/),"QQ"==t&&(n=/^[1-9][0-9]{4,10}$/),"weixin"==t&&(n=/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/),"plate"==t&&(n=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/),!n)throw new Error("The second parameter is out of scope");return n.test(e)},getUrlParams(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1);if(!n){let e=window.location.hash.split("?");2==e.length&&(n=e[1])}let s=n.match(t);return s?decodeURIComponent(s[2]):null},isEmptyObject(e){return!!this.isObject(e)&&0==Object.keys(e).length},equal(e,t){if(typeof e!=typeof t)return!1;if(this.isObject(e)&&this.isObject(t)){let n=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(n.length!=s.length)return!1;let i=n.length,r=!0;for(let o=0;o<i;o++){let s=n[o],i=e[s],l=t[s];if(!this.equal(i,l)){r=!1;break}}return r}return e===t},isObject:e=>!("object"!=typeof e||!e),copyText(e){if(!e||"string"!=typeof e)throw new TypeError("No text to copy is defined");if(!navigator.clipboard)throw new Error("navigator.clipboard must be obtained in a secure environment, such as localhost, 127.0.0.1, or https, so the method won't work");return navigator.clipboard.writeText(e)},clone(e){if(this.isObject(e)){if(Array.isArray(e))return e.map((e=>this.clone(e)));let t={};for(let n in e)t[n]=this.clone(e[n]);return t}return e}},h=e=>{let t=e.split(/[\s]+/g),n=[];return t.forEach((e=>{let t=e.split("."),s={eventName:t[0]};t.length>1&&(s.guid=t[1]),n.push(s)})),n},c=(e,t,n)=>{let s=l.get(e,"dap-defined-events")||{},i=Object.keys(s),r=i.length;for(let o=0;o<r;o++){let r=i[o];s[r].type==t&&(n?r==t+"."+n&&(e.removeEventListener(s[r].type,s[r].fn,s[r].options),s[r]=void 0):(e.removeEventListener(s[r].type,s[r].fn,s[r].options),s[r]=void 0))}s=(e=>{let t={};return Object.keys(e).forEach((n=>{e[n]&&(t[n]=e[n])})),t})(s),l.set(e,"dap-defined-events",s)},d={on(e,t,n,s){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!n||"function"!=typeof n)throw new TypeError("The third argument must be a function");a.isObject(s)||(s={});h(t).forEach((t=>{((e,t,n,s,i)=>{let r=l.get(e,"dap-defined-events")||{};n||(n=l.get(e,"dap-event-guid")||0,l.set(e,"dap-event-guid",n+1)),r[n=t+"."+n]&&r[n].type==t&&e.removeEventListener(t,r[n].fn,r[n].options),e.addEventListener(t,s,i),r[n]={type:t,fn:s,options:i},l.set(e,"dap-defined-events",r)})(e,t.eventName,t.guid,n.bind(e),s)}))},off(e,t){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=l.get(e,"dap-defined-events");if(!n)return;if(!t){let t=Object.keys(n),s=t.length;for(let i=0;i<s;i++){let s=t[i];e.removeEventListener(n[s].type,n[s].fn,n[s].options)}return l.remove(e,"dap-defined-events"),void l.remove(e,"dap-event-guid")}h(t).forEach((t=>{c(e,t.eventName,t.guid)}))},get(e){if(!(e instanceof Document||r.isElement(e)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let t=l.get(e,"dap-defined-events");if(t)return t}},m={language:()=>window.navigator.browserLanguage||window.navigator.language,device(){const e=window.navigator.userAgent;return{PC:!e.match(/AppleWebKit.*Mobile.*/),Mobile:!!e.match(/AppleWebKit.*Mobile.*/),iPhone:e.includes("iPhone"),Phone:e.includes("Android")&&/(?:Mobile)/.test(e)||e.includes("iPhone")||/(?:Windows Phone)/.test(e),iPad:e.includes("iPad"),Tablet:e.includes("iPad")||e.includes("Android")&&!/(?:Mobile)/.test(e)||e.includes("Firefox")&&/(?:Tablet)/.test(e),WindowsPhone:/(?:Windows Phone)/.test(e)}},browser(){const e=window.navigator.userAgent;return{Edge:!!e.match(/Edg\/([\d.]+)/),weixin:e.includes("MicroMessenger"),QQ:e.includes("QQ"),QQBrowser:e.includes("MQQBrowser"),UC:e.includes("UCBrowser"),Chrome:e.includes("Chrome"),Firefox:e.includes("Firefox"),sougou:e.toLocaleLowerCase().includes("se 2.x")||e.toLocaleLowerCase().includes("metasr")||e.toLocaleLowerCase().includes("sogou"),Safari:e.includes("Safari")&&!e.includes("Chrome")}},browserKernel(){const e=window.navigator.userAgent;return e.includes("Presto")?"opera":e.includes("AppleWebKit")?"webkit":e.includes("Gecko")&&!e.includes("KHTML")?"gecko":""},os(){const e=window.navigator.userAgent;return{Windows:e.includes("Windows"),Windows_CPU:e.toLocaleLowerCase().includes("win64")||e.toLocaleLowerCase().includes("wow64")?"x64":e.toLocaleLowerCase().includes("win32")||e.toLocaleLowerCase().includes("wow32")?"x32":"",Windows_Version:e.includes("Windows NT 6.1")||e.includes("Windows 7")?"Win7":e.includes("Windows NT 6.3")||e.includes("Windows NT 6.2")||e.includes("Windows NT 8")?"Win8":e.includes("Windows NT 10")||e.includes("Windows NT 6.4")?"Win10":"",Mac:e.includes("Macintosh"),Mac_Version:function(){if(e.includes("Macintosh")){const t=e.match(/Mac OS X ([^\s]+)\)/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ios_Version:function(){if(e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){const t=e.match(/CPU.+OS ([^\s]+) like Mac OS X/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),Android:e.includes("Android"),Android_Version:function(){const t=e.match(/Android ([^\s]+);/);return t&&t[1]?t[1].split(/_|\./).join("."):""}(),Linux:e.includes("Linux"),HarmonyOS:e.includes("HarmonyOS"),Ubuntu:e.includes("Ubuntu")}}},u=function(e){return/^[\uFEFF]+$/g.test(e)},f=function(e){return a.isObject(e)||Array.isArray(e)?JSON.parse(JSON.stringify(e)):e},g=function(e,t){return 3==t.nodeType?r.isContains(e,t.parentNode):r.isContains(e,t)},p=function(e){return new Promise((t=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.readAsDataURL(e)}))},E=class e{constructor(e,t,n,s,i){this.key=function(){let e=l.get(window,"data-alex-editor-key")||0;return e++,l.set(window,"data-alex-editor-key",e),e}(),this.type=e,this.parsedom=t,this.marks=n,this.styles=s,this.textContent=i,this.children=null,this.parent=null,this.behavior="default",this.elm=null}isBlock(){return"block"==this.type}isInblock(){return"inblock"==this.type}isInline(){return"inline"==this.type}isClosed(){return"closed"==this.type}isText(){return"text"==this.type}isBreak(){return this.isClosed()&&"br"==this.parsedom}isEmpty(){if(this.isText())return!this.textContent;if(this.isBlock()||this.isInblock()||this.isInline()){if(!this.hasChildren())return!0;return this.children.every((e=>!e||e.isEmpty()))}return!1}isSpaceText(){return this.isText()&&!this.isEmpty()&&u(this.textContent)}getUneditableElement(){return this.hasMarks()&&"false"==this.marks.contenteditable?this:this.isBlock()?null:this.parent.getUneditableElement()}isEqual(t){return!!e.isElement(t)&&this.key==t.key}isContains(e){return!!this.isEqual(e)||!e.isBlock()&&this.isContains(e.parent)}isOnlyHasBreak(){return!!this.hasChildren()&&this.children.every((e=>e.isBreak()||e.isEmpty()))}isPreStyle(){const e=this.getBlock(),t=this.getInblock();return t?"pre"==t.parsedom||(!(!t.hasStyles()||"pre"!=t.styles["white-space"]&&"pre-wrap"!=t.styles["white-space"])||t.parent.isPreStyle()):"pre"==e.parsedom||!(!e.hasStyles()||"pre"!=e.styles["white-space"]&&"pre-wrap"!=e.styles["white-space"])}hasMarks(){return!!this.marks&&(!!a.isObject&&!a.isEmptyObject(this.marks))}hasStyles(){return!!this.styles&&(!!a.isObject(this.styles)&&!a.isEmptyObject(this.styles))}hasChildren(){return!this.isClosed()&&!this.isText()&&(!!Array.isArray(this.children)&&!!this.children.length)}hasContains(e){return this.isContains(e)||e.isContains(this)}clone(t=!0){if("boolean"!=typeof t)throw new Error("The parameter must be a Boolean");let n=new e(this.type,this.parsedom,f(this.marks),f(this.styles),this.textContent);return n.behavior=this.behavior,t&&this.hasChildren()&&this.children.forEach((e=>{let s=e.clone(t);n.hasChildren()?n.children.push(s):n.children=[s],s.parent=n})),n}convertToBlock(){if(this.isBlock())return;let t=this.clone();this.type="block",this.parsedom=e.BLOCK_NODE,this.marks=null,this.styles=null,this.textContent=null,this.children=[t],t.parent=this}toEmpty(){if(!this.isEmpty())return this.isText()?(this.marks=null,this.styles=null,this.textContent=null,void(this.elm=null)):this.isClosed()?(this.type="text",this.parsedom=null,this.marks=null,this.styles=null,this.textContent=null,void(this.elm=null)):void(this.hasChildren()&&this.children.forEach((e=>{e.toEmpty()})))}getBlock(){return this.isBlock()?this:this.parent.getBlock()}getInblock(){return this.isInblock()?this:this.isBlock()?null:this.parent.getInblock()}getInline(){return this.isInline()?this:this.isBlock()?null:this.parent.getInline()}isEqualStyles(e){return!this.hasStyles()&&!e.hasStyles()||!!(this.hasStyles()&&e.hasStyles()&&a.equal(this.styles,e.styles))}isEqualMarks(e){return!this.hasMarks()&&!e.hasMarks()||!!(this.hasMarks()&&e.hasMarks()&&a.equal(this.marks,e.marks))}isFirst(t){if(!this.isText()&&!this.isClosed())return!1;if(t.isEqual(this))return!1;if(t.isContains(this)){const n=e.flatElements(t.children).filter((e=>e.isText()||e.isClosed()));return this.isEqual(n[0])}return!1}isLast(t){if(!this.isText()&&!this.isClosed())return!1;if(t.isEqual(this))return!1;if(t.isContains(this)){const n=e.flatElements(t.children).filter((e=>e.isText()||e.isClosed())),s=n.length;return this.isEqual(n[s-1])}return!1}__render(){let t=null;if(this.isText()){t=document.createElement(e.TEXT_NODE);const n=document.createTextNode(this.textContent);t.appendChild(n)}else t=document.createElement(this.parsedom),this.hasChildren()&&this.children.forEach((e=>{e.__render(),t.appendChild(e.elm)}));this.hasMarks()&&Object.keys(this.marks).forEach((e=>{/(^on)|(^style$)|(^face$)/g.test(e)||t.setAttribute(e,this.marks[e])})),this.hasStyles()&&Object.keys(this.styles).forEach((e=>{t.style.setProperty(e,this.styles[e])})),l.set(t,"data-alex-editor-key",this.key),this.elm=t}__fullClone(){let t=new e(this.type,this.parsedom,f(this.marks),f(this.styles),this.textContent);return t.behavior=this.behavior,t.key=this.key,t.elm=this.elm,this.hasChildren()&&this.children.forEach((e=>{let n=e.__fullClone();t.hasChildren()?t.children.push(n):t.children=[n],n.parent=t})),t}static isElement(t){return t instanceof e}static flatElements(e){const t=e=>{let n=[];const s=e.length;for(let i=0;i<s;i++)if(n.push(e[i]),e[i].hasChildren()){const s=t(e[i].children);n.push(...s)}return n};return t(e)}static getSpaceElement(){return new e("text",null,null,null,"\ufeff")}};n(E,"BLOCK_NODE","p"),n(E,"TEXT_NODE","span"),n(E,"VOID_NODES",["colgroup","col"]);let y=E;class b{constructor(e,t){this.anchor=e,this.focus=t}}class w{constructor(e,t){if(this.element=e,this.offset=t,this.element.isText()||this.element.isClosed()){if(y.VOID_NODES.includes(this.element.parsedom))throw new Error("Invisible element cannot be set as focal point")}else 0==this.offset?this.moveToStart(this.element):this.moveToEnd(this.element)}static isPoint(e){return e instanceof w}isEqual(e){return!!w.isPoint(e)&&(this.element.isEqual(e.element)&&this.offset==e.offset)}moveToEnd(e){if(!y.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=e.textContent.length;else if(e.isClosed()){if(y.VOID_NODES.includes(e.parsedom))throw new Error("Invisible element cannot be set as focal point");this.element=e,this.offset=1}else if(e.hasChildren()){const t=y.flatElements(e.children).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom))),n=t.length;if(0==n)throw new Error("There is no element to set the focus");this.moveToEnd(t[n-1])}}moveToStart(e){if(!y.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=0;else if(e.isClosed()){if(y.VOID_NODES.includes(e.parsedom))throw new Error("Invisible element cannot be set as focal point");this.element=e,this.offset=0}else if(e.hasChildren()){const t=y.flatElements(e.children).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom)));if(0==t.length)throw new Error("There is no element to set the focus");this.moveToStart(t[0])}}}class T{constructor(){this.records=[],this.current=-1}push(e,t){this.current<this.records.length-1&&(this.records.length=this.current+1);const n=e.map((e=>e.__fullClone())),s=this.__cloneRange(n,t);this.records.push({stack:n,range:s}),this.current+=1}get(e){let t=this.current;if(-1==e){if(t<=0)return null;t-=1}else if(1==e){if(t>=this.records.length-1)return null;t+=1}const{stack:n,range:s}=this.records[t],i=n.map((e=>e.__fullClone()));return{current:t,stack:i,range:this.__cloneRange(i,s)}}updateCurrentRange(e){const t=this.records[this.current],n=this.__cloneRange(t.stack,e);this.records[this.current].range=n}__cloneRange(e,t){if(t){const n=y.flatElements(e).find((e=>e.key==t.anchor.element.key)),s=y.flatElements(e).find((e=>e.key==t.focus.element.key));if(n&&s){const e=new w(n,t.anchor.offset),i=new w(s,t.focus.offset);return new b(e,i)}}return null}}const C=[{parsedom:"p"},{parsedom:"div"},{parsedom:"table"},{parsedom:"ul"},{parsedom:"ol"},{parsedom:"h1"},{parsedom:"h2"},{parsedom:"h3"},{parsedom:"h4"},{parsedom:"h5"},{parsedom:"h6"},{parsedom:"blockquote"},{parsedom:"pre"},{parsedom:"address",parse:!0},{parsedom:"article",parse:!0},{parsedom:"aside",parse:!0},{parsedom:"nav",parse:!0},{parsedom:"section",parse:!0}],x=[{parsedom:"br"},{parsedom:"col"},{parsedom:"img"},{parsedom:"hr"},{parsedom:"video"},{parsedom:"audio"}],k=[{parsedom:"li",block:!0},{parsedom:"tfoot"},{parsedom:"tbody"},{parsedom:"thead"},{parsedom:"tr"},{parsedom:"th"},{parsedom:"td"},{parsedom:"colgroup"}],v=[{parsedom:"span"},{parsedom:"a"},{parsedom:"label"},{parsedom:"code"},{parsedom:"b",parse:{"font-weight":"bold"}},{parsedom:"strong",parse:{"font-weight":"bold"}},{parsedom:"sup",parse:{"vertical-align":"super"}},{parsedom:"sub",parse:{"vertical-align":"sub"}},{parsedom:"i",parse:{"font-style":"italic"}},{parsedom:"u",parse:{"text-decoration-line":"underline"}},{parsedom:"del",parse:{"text-decoration-line":"line-through"}},{parsedom:"abbr",parse:!0},{parsedom:"acronym",parse:!0},{parsedom:"bdo",parse:!0},{parsedom:"font",parse:!0,parse:{"font-family":function(e){return e.getAttribute("face")||""}}}],S=function(e){if(e.hasChildren()){e.children.filter((e=>!e.isEmpty())).filter((e=>e.isBlock())).forEach((t=>{t.type="inline"==e.type?"inline":"inblock"}))}},_=function(e){if(e.hasChildren()){const t=e.children.filter((e=>!e.isEmpty()));t.every((e=>e.isInblock()))||t.forEach((e=>{e.isInblock()&&(e.type="inline")}))}},P=function(e){if(e.isInline()&&e.hasChildren()){e.children.filter((e=>!e.isEmpty())).filter((e=>e.isInblock())).forEach((e=>{e.isInblock()&&(e.type="inline")}))}},I=function(e){if(e.hasChildren()){const t=e.children.filter((e=>!e.isEmpty()));if(t.every((e=>e.isBreak()))&&t.length){const n=t[0];this.range&&e.isContains(this.range.anchor.element)&&this.range.anchor.moveToStart(n),this.range&&e.isContains(this.range.focus.element)&&this.range.focus.moveToStart(n),e.children=[n]}else e.children.forEach((e=>{e.isBreak()&&e.toEmpty()}))}},O=function(e){const t=(e,t)=>{if(e.isEmpty()||t.isEmpty()){if(t.isEmpty()){this.range&&t.isContains(this.range.anchor.element)&&(e.isEmpty()?(this.range.anchor.element=e,this.range.anchor.offset=0):this.range.anchor.moveToEnd(e)),this.range&&t.isContains(this.range.focus.element)&&(e.isEmpty()?(this.range.focus.element=e,this.range.focus.offset=0):this.range.focus.moveToEnd(e));const n=t.parent.children.findIndex((e=>t.isEqual(e)));t.parent.children.splice(n,1)}else if(e.isEmpty()){this.range&&e.isContains(this.range.anchor.element)&&(t.isEmpty()?(this.range.anchor.element=t,this.range.anchor.offset=0):this.range.anchor.moveToStart(t)),this.range&&e.isContains(this.range.focus.element)&&(t.isEmpty()?(this.range.focus.element=t,this.range.focus.offset=0):this.range.focus.moveToStart(t));const n=e.parent.children.findIndex((t=>e.isEqual(t)));e.parent.children.splice(n,1)}}else if(e.isText()){this.range&&t.isEqual(this.range.anchor.element)&&(this.range.anchor.element=e,this.range.anchor.offset=e.textContent.length+this.range.anchor.offset),this.range&&t.isEqual(this.range.focus.element)&&(this.range.focus.element=e,this.range.focus.offset=e.textContent.length+this.range.focus.offset),e.textContent+=t.textContent;const n=t.parent.children.findIndex((e=>t.isEqual(e)));t.parent.children.splice(n,1)}else if(e.isInline()){e.children.push(...t.children),e.children.forEach((t=>{t.parent=e})),n(e);const s=t.parent.children.findIndex((e=>t.isEqual(e)));t.parent.children.splice(s,1)}},n=e=>{if(e.hasChildren()&&e.children.length>1){let i=0;for(;i<=e.children.length-2;)n=e.children[i],s=e.children[i+1],n.isEmpty()||s.isEmpty()||(n.isText()&&s.isText()?n.isEqualStyles(s)&&n.isEqualMarks(s):n.isInline()&&s.isInline()&&n.parsedom==s.parsedom&&n.isEqualMarks(s)&&n.isEqualStyles(s))?t(e.children[i],e.children[i+1]):i++}var n,s};n(e)},N=function(e){const t=(e,t)=>{t.isText()?(e.type="text",e.parsedom=null,t.hasMarks()&&(e.hasMarks()?Object.assign(e.marks,f(t.marks)):e.marks=f(t.marks)),t.hasStyles()&&(e.hasStyles()?Object.assign(e.styles,f(t.styles)):e.styles=f(t.styles)),e.textContent=t.textContent,e.children=null,this.range&&t.isContains(this.range.anchor.element)&&(this.range.anchor.element=e),this.range&&t.isContains(this.range.focus.element)&&(this.range.focus.element=e)):(t.hasMarks()&&(e.hasMarks()?Object.assign(e.marks,f(t.marks)):e.marks=f(t.marks)),t.hasStyles()&&(e.hasStyles()?Object.assign(e.styles,f(t.styles)):e.styles=f(t.styles)),t.hasChildren()&&(e.children=[...t.children],e.children.forEach((t=>{t.parent=e}))))};var n,s;e.hasChildren()&&1==e.children.length&&(n=e,(s=e.children[0]).isText()&&n.isInline()?n.parsedom==y.TEXT_NODE:(n.isInline()&&s.isInline()||n.isInblock()&&s.isInblock())&&n.parsedom==s.parsedom)&&t(e,e.children[0])},{Mac:B}=m.os(),A=function(){if(0==y.flatElements(this.stack).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom))).length){const e=new y("block",y.BLOCK_NODE,null,null,null),t=new y("closed","br",null,null,null);this.addElementTo(t,e),this.stack=[e]}},L=function(e){const t=this.getPreviousElementOfPoint(e),n=this.getNextElementOfPoint(e),s=e.element.getBlock(),i=e.element.getInblock();t&&i&&i.isContains(t)?e.moveToEnd(t):n&&i&&i.isContains(n)?e.moveToStart(n):t&&s.isContains(t)?e.moveToEnd(t):n&&s.isContains(n)?e.moveToStart(n):t?e.moveToEnd(t):n&&e.moveToStart(n)},q=function(e){e.isInblock()&&"default"==e.behavior&&e.hasChildren()&&e.children.forEach((e=>{if(e.isInblock())q.apply(this,[e]);else if(e.toEmpty(),e.parent.isEmpty()){const t=new y("closed","br",null,null,null);this.addElementTo(t,e.parent)}}))},R=function(){var e;const t=async e=>{const t=r.getScrollHeight(e),n=r.getScrollWidth(e);if(e.clientHeight<t||e.clientWidth<n){const s=window.getSelection();if(0==s.rangeCount)return;const i=s.getRangeAt(0),o=i.getClientRects();let l=i;0==o.length&&(l=this.range.focus.element.elm);const a=l.getBoundingClientRect(),h=e.getBoundingClientRect();if(e.clientHeight<t)if(a.bottom<h.top){await r.setScrollTop({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollTop({el:e,number:t.top-n.top})}else if(a.top>h.bottom){await r.setScrollTop({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollTop({el:e,number:t.bottom-n.bottom})}if(e.clientWidth<n)if(a.right<h.left){await r.setScrollLeft({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollLeft({el:e,number:t.left-n.left+20})}else if(a.left>h.right){await r.setScrollLeft({el:e,number:0});const t=l.getBoundingClientRect(),n=e.getBoundingClientRect();r.setScrollLeft({el:e,number:t.right-n.right+20})}}};if(null==(e=this.range)?void 0:e.focus.element.elm){let e=this.range.focus.element.elm;for(;r.isElement(e)&&e!=document.documentElement;)t(e),e=e.parentNode}},D=function(){if(0==y.flatElements(this.stack).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom))).length){const e=new y("block",y.BLOCK_NODE,null,null,null),t=new y("closed","br",null,null,null);this.addElementTo(t,e),this.stack=[e],this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t)}},H=function(){if(this.__isInputChinese)return;if(this.__innerSelectionChange)return;const e=window.getSelection();if(e.rangeCount){const t=e.getRangeAt(0);if(g(this.$el,t.startContainer)&&g(this.$el,t.endContainer)){let e=null,n=null,s=null,i=null;if(3==t.startContainer.nodeType)e=t.startContainer.parentNode,s=t.startOffset;else if(1==t.startContainer.nodeType){const n=Array.from(t.startContainer.childNodes);n.length?(e=n[t.startOffset]?n[t.startOffset]:n[t.startOffset-1],s=n[t.startOffset]?0:1,3==e.nodeType&&(s=0==s?0:e.textContent.length,e=e.parentNode)):(e=t.startContainer,s=0)}if(3==t.endContainer.nodeType)n=t.endContainer.parentNode,i=t.endOffset;else if(1==t.endContainer.nodeType){const e=Array.from(t.endContainer.childNodes);e.length?(n=e[t.endOffset]?e[t.endOffset]:e[t.endOffset-1],i=e[t.endOffset]?0:1,3==n.nodeType&&(i=0==i?0:n.textContent.length,n=n.parentNode)):(n=t.endContainer,i=1)}const r=l.get(e,"data-alex-editor-key"),o=l.get(n,"data-alex-editor-key"),a=this.getElementByKey(r),h=this.getElementByKey(o),c=new w(a,s),d=new w(h,i);this.range?(this.range.anchor=c,this.range.focus=d):this.range=new b(c,d),this.history.updateCurrentRange(this.range),this.emit("rangeUpdate",this.range)}}},M=function(e){this.disabled||"deleteByCut"!=e.inputType&&"insertFromPaste"!=e.inputType&&"deleteByDrag"!=e.inputType&&"insertFromDrop"!=e.inputType&&(e.preventDefault(),"insertText"==e.inputType&&e.data?(this.insertText(e.data),this.formatElementStack(),this.domRender(),this.rangeRender()):"insertParagraph"==e.inputType||"insertLineBreak"==e.inputType?(this.insertParagraph(),this.formatElementStack(),this.domRender(),this.rangeRender()):"deleteContentBackward"==e.inputType&&(this.delete(),this.formatElementStack(),this.domRender(),this.rangeRender()))},W=function(e){this.disabled||(e.preventDefault(),"compositionstart"==e.type?(this.__chineseInputTimer&&(clearTimeout(this.__chineseInputTimer),this.__chineseInputTimer=null),this.__isInputChinese=!0):"compositionend"==e.type&&(e.data&&(this.insertText(e.data),this.formatElementStack(),this.domRender(),this.rangeRender()),this.__chineseInputTimer=setTimeout((()=>{this.__isInputChinese=!1}),0)))},$=function(e){if(!this.disabled&&!this.__isInputChinese)if(function(e){return B?90==e.keyCode&&e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.altKey:90==e.keyCode&&e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey}(e)){e.preventDefault();const t=this.history.get(-1);t&&(this.history.current=t.current,this.stack=t.stack,this.range=t.range,this.formatElementStack(),this.domRender(!0),this.rangeRender())}else if(function(e){return B?90==e.keyCode&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey:89==e.keyCode&&e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey}(e)){e.preventDefault();const t=this.history.get(1);t&&(this.history.current=t.current,this.stack=t.stack,this.range=t.range,this.formatElementStack(),this.domRender(!0),this.rangeRender())}},j=async function(e){e.preventDefault(),await this.copy()},V=async function(e){e.preventDefault();await this.cut()&&!this.disabled&&(this.formatElementStack(),this.domRender(),this.rangeRender())},K=async function(e){e.preventDefault(),this.disabled||(await this.paste(),this.formatElementStack(),this.domRender(),this.rangeRender())},F=function(e){e.preventDefault()},U=function(e){this.disabled||this.emit("focus",this.value)},z=function(e){this.disabled||this.emit("blur",this.value)};class Q{constructor(e,t){this.$el=function(e){if("string"==typeof e&&e&&(e=document.body.querySelector(e)),!r.isElement(e))throw new Error("You must specify a dom container to initialize the editor");if(l.get(e,"data-alex-editor-init"))throw new Error("The element node has been initialized to the editor");return l.set(e,"data-alex-editor-init",!0),e}(e);const n=function(e){let t={disabled:!1,renderRules:[],value:"",allowCopy:!0,allowPaste:!0,allowCut:!0,allowPasteHtml:!1,customTextPaste:null,customHtmlPaste:null,customImagePaste:null,customVideoPaste:null,customMerge:null,customParseNode:null};return a.isObject(e)&&("boolean"==typeof e.disabled&&(t.disabled=e.disabled),Array.isArray(e.renderRules)&&(t.renderRules=e.renderRules),"string"==typeof e.value&&e.value&&(t.value=e.value),"boolean"==typeof e.allowCopy&&(t.allowCopy=e.allowCopy),"boolean"==typeof e.allowPaste&&(t.allowPaste=e.allowPaste),"boolean"==typeof e.allowCut&&(t.allowCut=e.allowCut),"boolean"==typeof e.allowPasteHtml&&(t.allowPasteHtml=e.allowPasteHtml),"function"==typeof e.customTextPaste&&(t.customTextPaste=e.customTextPaste),"function"==typeof e.customHtmlPaste&&(t.customHtmlPaste=e.customHtmlPaste),"function"==typeof e.customImagePaste&&(t.customImagePaste=e.customImagePaste),"function"==typeof e.customVideoPaste&&(t.customVideoPaste=e.customVideoPaste),"function"==typeof e.customMerge&&(t.customMerge=e.customMerge),"function"==typeof e.customParseNode&&(t.customParseNode=e.customParseNode)),t}(t);this.disabled=n.disabled,this.value=n.value,this.renderRules=n.renderRules,this.allowCopy=n.allowCopy,this.allowPaste=n.allowPaste,this.allowCut=n.allowCut,this.allowPasteHtml=n.allowPasteHtml,this.customTextPaste=n.customTextPaste,this.customHtmlPaste=n.customHtmlPaste,this.customImagePaste=n.customImagePaste,this.customVideoPaste=n.customVideoPaste,this.customMerge=n.customMerge,this.customParseNode=n.customParseNode,this.useClipboard=window.ClipboardItem?!!navigator.clipboard||(console.warn("navigator.clipboard must be obtained in a secure environment, such as localhost, 127.0.0.1, or https, so the editor's copy, paste, and cut functions cannot be used"),!1):(console.warn("window.ClipboardItem must be obtained in a secure environment, such as localhost, 127.0.0.1, or https, so the editor's copy, paste, and cut functions cannot be used"),!1),this.history=new T,this.stack=this.parseHtml(this.value),this.range=null,A.apply(this),this.__guid=function(){let e=l.get(window,"data-alex-editor-guid")||0;return e++,l.set(window,"data-alex-editor-guid",e),e}(),this.__events={},this.__firstRender=!0,this.__isInputChinese=!1,this.__innerSelectionChange=!1,this.__chineseInputTimer=null,this.disabled?this.setDisabled():this.setEnabled(),d.on(document,`selectionchange.alex_editor_${this.__guid}`,H.bind(this)),d.on(this.$el,"beforeinput.alex_editor",M.bind(this)),d.on(this.$el,"compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor",W.bind(this)),d.on(this.$el,"keydown.alex_editor",$.bind(this)),d.on(this.$el,"cut.alex_editor",V.bind(this)),d.on(this.$el,"paste.alex_editor",K.bind(this)),d.on(this.$el,"copy.alex_editor",j.bind(this)),d.on(this.$el,"dragstart.alex_editor drop.alex_editor ",F.bind(this)),d.on(this.$el,"focus.alex_editor",U.bind(this)),d.on(this.$el,"blur.alex_editor",z.bind(this))}initRange(){const e=y.flatElements(this.stack).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom)))[0],t=new w(e,0),n=new w(e,0);this.range=new b(t,n)}async paste(){if(this.disabled)return;if(!this.range)return;if(!this.useClipboard)return;if(!this.allowPaste)return;const e=(await navigator.clipboard.read())[0],t=[];e.types.forEach((n=>{t.push(e.getType(n))}));const n=await Promise.all(t),s=n.length;if(n.some((e=>"text/html"==e.type)))for(let i=0;i<s;i++){const e=n[i];if("text/plain"!=e.type||this.allowPasteHtml){if("text/html"==e.type&&this.allowPasteHtml){const t=await e.text();if(t){const e=this.parseHtml(t).filter((e=>!e.isEmpty()));if("function"==typeof this.customHtmlPaste)await this.customHtmlPaste.apply(this,[e,t]);else{for(let t=0;t<e.length;t++)this.formatElement(e[t]),this.insertElement(e[t],!1);this.emit("pasteHtml",e,t)}}}}else{const t=await e.text();t&&("function"==typeof this.customTextPaste?await this.customTextPaste.apply(this,[t]):(this.insertText(t),this.emit("pasteText",t)))}}else for(let i=0;i<s;i++){const e=n[i];if(e.type.startsWith("image/")){const t=await p(e);if("function"==typeof this.customImagePaste)await this.customImagePaste.apply(this,[t]);else{const e=new y("closed","img",{src:t},null,null);this.insertElement(e),this.emit("pasteImage",t)}}else if(e.type.startsWith("video/")){const t=await p(e);if("function"==typeof this.customVideoPaste)await this.customVideoPaste.apply(this,[t]);else{const e=new y("closed","video",{src:t},null,null);this.insertElement(e),this.emit("pasteVideo",t)}}else if("text/plain"==e.type){const t=await e.text();t&&("function"==typeof this.customTextPaste?await this.customTextPaste.apply(this,[t]):(this.insertText(t),this.emit("pasteText",t)))}}}async cut(){if(!this.useClipboard)return;if(!this.range)return;if(!this.allowCut)return;const e=await this.copy(!0);return e&&(this.disabled||this.delete(),this.emit("cut",e.text,e.html)),e}async copy(e=!1){if(!this.useClipboard)return;if(!this.range)return;if(!this.allowCopy)return;let t=this.getElementsByRange().list;if(0==t.length)return;let n="",s="";t.forEach((e=>{const t=e.element.clone();e.offset&&(t.textContent=t.textContent.substring(e.offset[0],e.offset[1])),t.__render(),n+=t.elm.outerHTML,s+=t.elm.innerText}));const i=new window.ClipboardItem({"text/html":new Blob([n],{type:"text/html"}),"text/plain":new Blob([s],{type:"text/plain"})});return await navigator.clipboard.write([i]),e||this.emit("copy",s,n),{text:s,html:n}}delete(){if(!this.disabled&&this.range){if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.range.anchor.element.getBlock(),n=this.range.anchor.element.getInblock();if(n)if(0==this.range.anchor.offset)if(e){if(n.isContains(e))return this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),void this.delete();if("block"==n.behavior){const t=e.getBlock(),s=e.getInblock();s?"block"==s.behavior&&this.merge(n,s):this.merge(n,t)}}else this.emit("deleteInStart",n);else if(this.range.anchor.element.isSpaceText()){if(this.range.anchor.element.toEmpty(),!n.isEmpty())return this.range.anchor.offset=0,this.range.focus.offset=0,void this.delete();{const e=new y("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else if(this.range.anchor.element.isText()){const e=this.range.anchor.element.textContent;this.range.anchor.offset-=1;const t=u(e[this.range.anchor.offset]);if(this.range.anchor.element.textContent=e.substring(0,this.range.anchor.offset)+e.substring(this.range.focus.offset),this.range.focus.offset=this.range.anchor.offset,t)return void this.delete();if(n.isEmpty()){const e=new y("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const t=this.range.anchor.element.isBreak();if(this.range.anchor.element.toEmpty(),n.isEmpty())if(t&&"default"!=n.behavior){if(!e){const e=new y("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const e=new y("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else if(0==this.range.anchor.offset)if(e){if(t.isContains(e))return this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),void this.delete();{const n=e.getInblock(),s=e.getBlock();n?"block"==n.behavior&&this.merge(t,n):this.merge(t,s)}}else this.emit("deleteInStart",t);else if(this.range.anchor.element.isSpaceText()){if(this.range.anchor.element.toEmpty(),!t.isEmpty())return this.range.anchor.offset=0,this.range.focus.offset=0,void this.delete();{const e=new y("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else if(this.range.anchor.element.isText()){const e=this.range.anchor.element.textContent;this.range.anchor.offset-=1;const n=u(e[this.range.anchor.offset]);if(this.range.anchor.element.textContent=e.substring(0,this.range.anchor.offset)+e.substring(this.range.focus.offset),this.range.focus.offset=this.range.anchor.offset,n)return void this.delete();if(t.isEmpty()){const e=new y("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const n=this.range.anchor.element.isBreak();if(this.range.anchor.element.toEmpty(),t.isEmpty()&&(!n||!e)){const e=new y("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}}else{const e=this.getElementsByRange().list.filter((e=>!y.VOID_NODES.includes(e.element.parsedom))),t=this.range.anchor.element.getInblock(),n=this.range.focus.element.getInblock(),s=this.range.anchor.element.getBlock(),i=this.range.focus.element.getBlock();t&&n&&t.isEqual(n)?e.forEach((e=>{if(e.offset?e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]):e.element.toEmpty(),t.isEmpty()){const e=new y("closed","br",null,null,null);this.addElementTo(e,t)}})):t&&n?(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)q.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new y("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),"block"==t.behavior&&"block"==n.behavior&&this.merge(n,t)):t?(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)q.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new y("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),"block"==t.behavior&&this.merge(i,t)):n?(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)q.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new y("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),"block"==n.behavior&&this.merge(n,s)):s.isEqual(i)?e.forEach((e=>{if(e.offset?e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]):e.element.toEmpty(),s.isEmpty()){const e=new y("closed","br",null,null,null);this.addElementTo(e,s)}})):(e.forEach((e=>{if(e.offset)e.element.textContent=e.element.textContent.substring(0,e.offset[0])+e.element.textContent.substring(e.offset[1]);else if(e.element.isInblock()&&"default"==e.element.behavior)q.apply(this,[e.element]);else if(e.element.toEmpty(),e.element.parent&&(e.element.parent.isInblock()||e.element.parent.isBlock())&&e.element.parent.isEmpty()){const t=new y("closed","br",null,null,null);this.addElementTo(t,e.element.parent)}})),this.merge(i,s))}this.range.anchor.element.isEmpty()&&L.apply(this,[this.range.anchor]),this.range.focus.element=this.range.anchor.element,this.range.focus.offset=this.range.anchor.offset,D.apply(this),this.emit("deleteComplete")}}insertText(e){if(!this.disabled&&this.range){if(!e||"string"!=typeof e)throw new Error("The argument must be a string");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.isPreStyle()||(e=e.replace(/\s/g,(()=>{const e=document.createElement("span");return e.innerHTML="&nbsp;",e.innerText}))),this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset)+e+t.substring(this.range.anchor.offset),this.range.anchor.offset=this.range.anchor.offset+e.length,this.range.focus.offset=this.range.anchor.offset}else{const t=new y("text",null,null,null,e);0==this.range.anchor.offset?this.addElementBefore(t,this.range.anchor.element):this.addElementAfter(t,this.range.anchor.element),this.range.anchor.moveToEnd(t),this.range.focus.moveToEnd(t)}else this.delete(),this.insertText(e)}}insertParagraph(){if(!this.disabled&&this.range)if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.getNextElementOfPoint(this.range.anchor),n=this.range.anchor.element.getBlock(),s=this.range.anchor.element.getInblock(),i=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(s){if(this.range.anchor.element.isPreStyle()){this.insertText("\n");const e=y.getSpaceElement();this.insertElement(e),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),this.emit("insertParagraph",null,s)}else if("block"==s.behavior)if(0!=this.range.anchor.offset||e&&s.isContains(e))if(this.range.anchor.offset!=i||t&&s.isContains(t)){const e=s.clone();this.addElementAfter(e,s);const t=y.flatElements(s.children).findIndex((e=>this.range.anchor.element.isEqual(e)));this.range.focus.moveToEnd(s),this.delete();const n=y.flatElements(e.children);this.range.focus.element=n[t],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(e),this.delete(),this.emit("insertParagraph",e,s)}else{const e=s.clone(!1),t=new y("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,s),this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t),this.emit("insertParagraph",e,s)}else{const e=s.clone(!1),t=new y("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,s),this.emit("insertParagraph",s,e)}}else if(this.range.anchor.element.isPreStyle()){this.insertText("\n");const e=y.getSpaceElement();this.insertElement(e),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),this.emit("insertParagraph",null,n)}else if(0!=this.range.anchor.offset||e&&n.isContains(e))if(this.range.anchor.offset!=i||t&&n.isContains(t)){const e=n.clone();this.addElementAfter(e,n);const t=y.flatElements(n.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=this.range.anchor.offset;this.range.focus.moveToEnd(n),this.delete();const i=y.flatElements(e.children);this.range.focus.element=i[t],this.range.focus.offset=s,this.range.anchor.moveToStart(e),this.delete(),this.emit("insertParagraph",e,n)}else{const e=n.clone(!1),t=new y("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,n),this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t),this.emit("insertParagraph",e,n)}else{const e=n.clone(!1),t=new y("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,n),this.emit("insertParagraph",n,e)}}else this.delete(),this.insertParagraph()}insertElement(e,t=!0){if(!this.disabled&&this.range){if(!y.isElement(e))throw new Error("The argument must be an AlexElement instance");if(!e.isEmpty())if(this.range.anchor.isEqual(this.range.focus)){const n=this.getPreviousElementOfPoint(this.range.anchor),s=this.getNextElementOfPoint(this.range.anchor),i=this.range.anchor.element.getBlock(),r=this.range.anchor.element.getInblock(),o=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(e.isInblock()&&"block"==e.behavior&&r&&"block"==r.behavior)if(r.isOnlyHasBreak()&&t)this.addElementBefore(e,r),r.toEmpty();else if(0!=this.range.anchor.offset||n&&r.isContains(n))if(this.range.anchor.offset!=o||s&&r.isContains(s)){const t=r.clone();this.addElementAfter(t,r),this.range.focus.moveToEnd(r),this.delete();const n=y.flatElements(r.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=y.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementBefore(e,t)}else this.addElementAfter(e,r);else this.addElementBefore(e,r);else if(e.isInblock()&&r)if(r.isOnlyHasBreak())this.addElementTo(e,r,0);else if(0!=this.range.anchor.offset||n&&r.isContains(n))if(this.range.anchor.offset!=o||s&&r.isContains(s)){const t=r.clone();this.addElementAfter(t,r),this.range.focus.moveToEnd(r),this.delete();const n=y.flatElements(r.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=y.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementTo(e,t),this.merge(t,r)}else this.addElementTo(e,r,r.children.length);else this.addElementTo(e,r,0);else if(e.isInblock())if(i.isOnlyHasBreak())this.addElementTo(e,i,0);else if(0!=this.range.anchor.offset||n&&i.isContains(n))if(this.range.anchor.offset!=o||s&&i.isContains(s)){const t=i.clone();this.addElementAfter(t,i),this.range.focus.moveToEnd(i),this.delete();const n=y.flatElements(i.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=y.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementTo(e,t),this.merge(t,i)}else this.addElementTo(e,i,i.children.length);else this.addElementTo(e,i,0);else if(e.isBlock())if(i.isOnlyHasBreak()&&t)this.addElementBefore(e,i),i.toEmpty();else if(0!=this.range.anchor.offset||n&&i.isContains(n))if(this.range.anchor.offset!=o||s&&i.isContains(s)){const t=i.clone();this.addElementAfter(t,i),this.range.focus.moveToEnd(i),this.delete();const n=y.flatElements(i.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=y.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementBefore(e,t)}else this.addElementAfter(e,i);else this.addElementBefore(e,i);else if(this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent,n=this.range.anchor.element.clone();this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset),n.textContent=t.substring(this.range.anchor.offset),this.addElementAfter(n,this.range.anchor.element),this.addElementBefore(e,n)}else 0==this.range.anchor.offset?this.addElementBefore(e,this.range.anchor.element):this.addElementAfter(e,this.range.anchor.element);this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}else this.delete(),this.insertElement(e,t)}}formatElement(e){let t=this.renderRules.filter((e=>"function"==typeof e));if([S,_,P,I,O,N,...t].forEach((t=>{t.apply(this,[e])})),e.hasChildren()){let t=e.children.length;for(let n=0;n<t;n++){const s=e.children[n];s.isEmpty()?(this.range&&s.isContains(this.range.anchor.element)&&L.apply(this,[this.range.anchor]),this.range&&s.isContains(this.range.focus.element)&&L.apply(this,[this.range.focus]),e.children.splice(n,1),n-=1,t-=1):(this.formatElement(s),s.isEmpty()&&(this.range&&s.isContains(this.range.anchor.element)&&L.apply(this,[this.range.anchor]),this.range&&s.isContains(this.range.focus.element)&&L.apply(this,[this.range.focus]),e.children.splice(n,1),n-=1,t-=1))}}}formatElementStack(){let e=this.stack.length;for(let t=0;t<e;t++){const n=this.stack[t];n.isEmpty()?(this.range&&n.isContains(this.range.anchor.element)&&L.apply(this,[this.range.anchor]),this.range&&n.isContains(this.range.focus.element)&&L.apply(this,[this.range.focus]),this.stack.splice(t,1),t-=1,e-=1):(n.isBlock()||n.convertToBlock(),this.formatElement(n),n.isEmpty()&&(this.range&&n.isContains(this.range.anchor.element)&&L.apply(this,[this.range.anchor]),this.range&&n.isContains(this.range.focus.element)&&L.apply(this,[this.range.focus]),this.stack.splice(t,1),t-=1,e-=1))}D.apply(this)}domRender(e=!1){this.emit("beforeRender");const t=document.createDocumentFragment();this.stack.forEach((e=>{e.__render(),t.appendChild(e.elm)})),this.$el.innerHTML="",this.$el.appendChild(t);const n=this.value;this.value=this.$el.innerHTML,(this.__firstRender||n!=this.value)&&(this.__firstRender||this.emit("change",this.value,n),e||this.history.push(this.stack,this.range)),this.__firstRender&&(this.__firstRender=!1),this.emit("afterRender")}rangeRender(){if(!this.disabled){if(this.range){const e=e=>{let t=null,n=null;if(e.element.isText())t=e.element.elm.childNodes[0],n=e.offset;else{t=e.element.parent.elm;const s=e.element.parent.children.findIndex((t=>e.element.isEqual(t)));n=e.offset+s}return{node:t,offset:n}};this.__innerSelectionChange=!0;const t=e(this.range.anchor),n=e(this.range.focus),s=window.getSelection();s.removeAllRanges();const i=document.createRange();i.setStart(t.node,t.offset),i.setEnd(n.node,n.offset),s.addRange(i)}else{window.getSelection().removeAllRanges()}setTimeout((()=>{R.apply(this),this.__innerSelectionChange=!1,this.history.updateCurrentRange(this.range),this.emit("rangeUpdate",this.range)}),0)}}parseHtml(e){if(!e)throw new Error("You need to give an html content to convert");const t=document.createElement("div");t.innerHTML=e;let n=[];return Array.from(t.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);n.push(t)}})),n}parseNode(e){if(!(e instanceof Node))throw new Error("The argument must be an node");if(1!=e.nodeType&&3!=e.nodeType)throw new Error("The argument must be an element node or text node");if(3==e.nodeType)return new y("text",null,null,null,e.textContent);const t=function(e){let t={};const n=e.attributes.length;for(let s=0;s<n;s++){const n=e.attributes[s];/(^on)|(^style$)|(^face$)/g.test(n.nodeName)||(t[n.nodeName]=n.nodeValue)}return t}(e),n=function(e){let t={};if(e.getAttribute("style")){const n=e.getAttribute("style");let s=0,i=0,r=[];for(;s<n.length;)";"==n[s]&&"base64,"!=n.substring(s+1,s+8)&&(r.push(n.substring(i,s)),i=s+1),s==n.length-1&&i<s&&r.push(n.substring(i,s)),s++;r.forEach((e=>{const n=e.indexOf(":"),s=e.substring(0,n).trim(),i=e.substring(n+1).trim();t[s]=i}))}return t}(e),s=e.nodeName.toLocaleLowerCase(),i=C.find((e=>e.parsedom==s)),r=k.find((e=>e.parsedom==s)),o=v.find((e=>e.parsedom==s)),l=x.find((e=>e.parsedom==s));let h=null,c={type:"inblock",parsedom:s,marks:t,styles:n,behavior:"default"};if(i)c.type="block",i.parse&&(c.parsedom=y.BLOCK_NODE);else if(r)c.type="inblock",r.block&&(c.behavior="block");else if(o){if(c.type="inline",o.parse&&(c.parsedom=y.TEXT_NODE,a.isObject(o.parse)))for(let a in o.parse)"function"==typeof o.parse[a]?c.styles[a]=o.parse[a].apply(this,[e]):c.styles[a]=o.parse[a]}else l?c.type="closed":(c.type="inline",c.parsedom="span");return h=new y(c.type,c.parsedom,c.marks,c.styles,null),h.behavior=c.behavior,l||Array.from(e.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);t.parent=h,h.hasChildren()?h.children.push(t):h.children=[t]}})),"function"==typeof this.customParseNode&&(h=this.customParseNode.apply(this,[h])),h}merge(e,t){if(!y.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!y.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(!e.isBlock()&&!e.isInblock()||!t.isBlock()&&!t.isInblock())throw new Error('Elements that are not "block" or "inblock" cannot be merged');"function"==typeof this.customMerge?this.customMerge.apply(this,[e,t]):(t.children.push(...e.children),t.children.forEach((e=>{e.parent=t})),e.children=null)}getElementByKey(e){if(!e)throw new Error("You need to specify a key to do the query");const t=n=>{let s=null;const i=n.length;for(let r=0;r<i;r++){if(n[r].key===e){s=n[r];break}if(n[r].hasChildren()){const e=t(n[r].children);if(e){s=e;break}}}return s};return t(this.stack)}getPreviousElement(e){if(!y.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isBlock()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t<=0?null:this.stack[t-1].isEmpty()?this.getPreviousElement(this.stack[t-1]):this.stack[t-1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t<=0?null:e.parent.children[t-1].isEmpty()?this.getPreviousElement(e.parent.children[t-1]):e.parent.children[t-1]}}getNextElement(e){if(!y.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isBlock()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t>=this.stack.length-1?null:this.stack[t+1].isEmpty()?this.getNextElement(this.stack[t+1]):this.stack[t+1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t>=e.parent.children.length-1?null:e.parent.children[t+1].isEmpty()?this.getNextElement(e.parent.children[t+1]):e.parent.children[t+1]}}getPreviousElementOfPoint(e){if(!w.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=e=>{let n=null;for(let s=e.length-1;s>=0;s--){const i=e[s];if(!i.isEmpty()){if(i.isText()||i.isClosed()){n=i;break}if(n=t(i.children),n)break}}return n},n=e=>{const s=this.getPreviousElement(e);return s?s.isEmpty()?n(s):s.isText()||s.isClosed()?s:t(s.children):e.parent?n(e.parent):null};return n(e.element)}getNextElementOfPoint(e){if(!w.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=e=>{let n=null;const s=e.length;for(let i=0;i<s;i++){const s=e[i];if(!s.isEmpty()){if(s.isText()||s.isClosed()){n=s;break}if(n=t(s.children),n)break}}return n},n=e=>{const s=this.getNextElement(e);return s?s.isEmpty()?n(s):s.isText()||s.isClosed()?s:t(s.children):e.parent?n(e.parent):null};return n(e.element)}getElementsByRange(){if(!this.range)return{list:[],flatList:[]};if(this.range.anchor.isEqual(this.range.focus))return{list:[],flatList:[]};if(this.range.anchor.element.isEqual(this.range.focus.element)){const e=0==this.range.anchor.offset&&this.range.focus.offset==(this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1);return{list:[{element:this.range.anchor.element,offset:!e&&[this.range.anchor.offset,this.range.focus.offset]}],flatList:[{element:this.range.anchor.element,offset:!e&&[this.range.anchor.offset,this.range.focus.offset]}]}}const e=(()=>{let e=[];const t=0==this.range.anchor.offset,n=this.range.focus.offset==(this.range.focus.element.isText()?this.range.focus.element.textContent.length:1),s=this.range.anchor.element.getBlock(),i=this.range.focus.element.getBlock(),r=this.stack.findIndex((e=>s.isEqual(e))),o=this.stack.findIndex((e=>i.isEqual(e)));let l=y.flatElements(this.stack.slice(r,o+1));const a=function(e){let t=e.element;for(;t.parent&&e.element.isFirst(t.parent);)t=t.parent;return t}(this.range.anchor),h=l.findIndex((e=>e.isEqual(a||this.range.anchor.element))),c=l.findIndex((e=>e.isEqual(this.range.focus.element)));(h>0||c<l.length-1)&&(l=l.slice(h,c+1));const d=l.length;for(let m=0;m<d;m++)if(this.range.anchor.element.isEqual(l[m]))t?e.push({element:this.range.anchor.element,offset:!1}):this.range.anchor.element.isText()&&this.range.anchor.offset<this.range.anchor.element.textContent.length&&e.push({element:this.range.anchor.element,offset:[this.range.anchor.offset,this.range.anchor.element.textContent.length]});else if(l[m].isContains(this.range.anchor.element)){const s=this.range.anchor.element.isFirst(l[m]),i=l[m].isContains(this.range.focus.element),r=this.range.focus.element.isLast(l[m]);(t&&s&&i&&r&&n||t&&s&&!i)&&e.push({element:l[m],offset:!1})}else if(this.range.focus.element.isEqual(l[m]))n?e.push({element:this.range.focus.element,offset:!1}):this.range.focus.offset>0&&e.push({element:this.range.focus.element,offset:[0,this.range.focus.offset]});else if(l[m].isContains(this.range.focus.element)){this.range.focus.element.isLast(l[m])&&n&&e.push({element:l[m],offset:!1})}else e.push({element:l[m],offset:!1});return e})();return{list:(e=>{let t=[],n=[],s=[];const i=e.length;for(let r=0;r<i;r++)if(e[r].element.isBlock())t.push(e[r]),n.push(e[r].element);else{const i=e[r].element.getBlock();let o=!1;for(let e=n.length-1;e>=0;e--)if(n[e].isEqual(i)){o=!0;break}if(!o){s.some((t=>t.isContains(e[r].element)))||(t.push(e[r]),(e[r].element.isInblock()||e[r].element.isInline())&&s.push(e[r].element))}}return t})(e),flatList:e}}addElementTo(e,t,n=0){if(!y.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!y.isElement(t))throw new Error("The second argument must be an AlexElement instance");if("number"!=typeof n||isNaN(n)||n<0)throw new Error("The third argument must be an integer not less than 0");t.hasChildren()?n>=t.children.length?t.children.push(e):t.children.splice(n,0,e):t.children=[e],e.parent=t}addElementBefore(e,t){if(!y.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!y.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isBlock()){const n=this.stack.findIndex((e=>t.isEqual(e)));this.stack.splice(n,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n)}}addElementAfter(e,t){if(!y.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!y.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isBlock()){const n=this.stack.findIndex((e=>t.isEqual(e)));n>=this.stack.length-1?this.stack.push(e):this.stack.splice(n+1,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n+1)}}collapseToStart(e){if(this.disabled)return;let t=!1;if(this.range||(this.initRange(),t=!0),y.isElement(e))this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e);else{const e=y.flatElements(this.stack).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom)));if(0==e.length)throw new Error("There is no element to set the focus");this.range.anchor.moveToStart(e[0]),this.range.focus.moveToStart(e[0])}t&&this.history.updateCurrentRange(this.range)}collapseToEnd(e){if(this.disabled)return;let t=!1;if(this.range||(this.initRange(),t=!0),y.isElement(e))this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e);else{const e=y.flatElements(this.stack).filter((e=>!e.isEmpty()&&!y.VOID_NODES.includes(e.parsedom))),t=e.length;if(0==t)throw new Error("There is no element to set the focus");this.range.anchor.moveToEnd(e[t-1]),this.range.focus.moveToEnd(e[t-1])}t&&this.history.updateCurrentRange(this.range)}setDisabled(){this.disabled=!0,this.$el.removeAttribute("contenteditable")}setEnabled(){this.disabled=!1,this.$el.setAttribute("contenteditable",!0)}emit(e,...t){return!!Array.isArray(this.__events[e])&&(this.__events[e].forEach((e=>{e.apply(this,[...t])})),!0)}on(e,t){this.__events[e]||(this.__events[e]=[]),this.__events[e].push(t)}destroy(){this.setDisabled(),d.off(document,`selectionchange.alex_editor_${this.__guid}`),d.off(this.$el,"beforeinput.alex_editor compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor keydown.alex_editor cut.alex_editor paste.alex_editor copy.alex_editor dragstart.alex_editor drop.alex_editor focus.alex_editor blur.alex_editor")}}e.AlexEditor=Q,e.AlexElement=y,e.default=Q,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
