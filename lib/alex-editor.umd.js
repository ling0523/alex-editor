!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["alex-editor"]={})}(this,(function(e){"use strict";var t=Object.defineProperty,n=(e,n,s)=>(((e,n,s)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s})(e,"symbol"!=typeof n?n+"":n,s),s);const s={formatNumber(e){return this.isNumber(e)?e.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):e},isNumber:e=>"number"==typeof e&&!isNaN(e),add:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,r=0;try{n=e.toString().split(".")[1].length}catch(i){}try{s=t.toString().split(".")[1].length}catch(i){}return r=Math.pow(10,Math.max(n,s)),(e*r+t*r)/r})),subtract:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,r=0;try{n=e.toString().split(".")[1].length}catch(i){}try{s=t.toString().split(".")[1].length}catch(i){}return r=Math.pow(10,Math.max(n,s)),(e*r-t*r)/r})),mutiply:(...e)=>e.reduce(((e,t)=>{let n=0,s=e.toString(),r=t.toString();try{n+=s.split(".")[1].length}catch(i){}try{n+=r.split(".")[1].length}catch(i){}return Number(s.replace(".",""))*Number(r.replace(".",""))/Math.pow(10,n)})),divide:(...e)=>e.reduce(((e,t)=>{let n=0,s=0,r=e.toString(),i=t.toString();try{n=r.split(".")[1].length}catch(o){}try{s=i.split(".")[1].length}catch(o){}return r=Number(r.replace(".","")),i=Number(i.replace(".","")),r/i*Math.pow(10,s-n)}))},r={insert(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if("string"!=typeof t)throw new TypeError("The second argument must be a string");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,n)+t+e.substring(n,e.length)},delete(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!s.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,t)+e.substring(t+n,e.length)},replace(e,t,n,r){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!s.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!s.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");if("string"!=typeof r)throw new TypeError("The fourth argument must be a string");return e.substring(0,t)+r+e.substring(n,e.length)},trim(e,t){if("string"!=typeof e)throw new TypeError("The first argument must be a string");let n=e.replace(/(^\s+)|(\s+$)/g,"");return t&&(n=n.replace(/\s/g,"")),n}},i={isWindow:e=>e&&e instanceof Window,getElementPoint(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(this.isElement(t)||(t=document.body),!this.isContains(t,e))throw new Error("The second argument and the first argument have no hierarchical relationship");let n=e,s=0,r=0;for(;this.isElement(e)&&this.isContains(t,e)&&t!==e;)s+=e.offsetTop,r+=e.offsetLeft,e=e.offsetParent;return{top:s,left:r,right:t.offsetWidth-r-n.offsetWidth,bottom:t.offsetHeight-s-n.offsetHeight}},isContains(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t,!0))throw new TypeError("The second argument must be an element");return e===t||(e.contains?e.contains(t):e.compareDocumentPosition?!!(16&e.compareDocumentPosition(t)):void 0)},isParentNode(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t,!0))throw new TypeError("The second argument must be an element");return e!==t&&t.parentNode===e},children(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");return[...e.querySelectorAll(t||"*")].filter((t=>t.parentNode===e))},siblings(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!e.parentNode)return[];return[...e.parentNode.querySelectorAll(t||"*")].filter((t=>t.parentNode===e.parentNode&&t!=e))},rem2px(e){if(!s.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return s.mutiply(e,parseFloat(t))},px2rem(e){if(!s.isNumber(e))throw new TypeError("The argument must be a number");let t=this.getCssStyle(document.documentElement,"font-size");return s.divide(e,parseFloat(t))},width(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientWidth,n=parseFloat(this.getCssStyle(e,"padding-left")),r=parseFloat(this.getCssStyle(e,"padding-right"));return s.subtract(t,n,r)},height(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.clientHeight,n=parseFloat(this.getCssStyle(e,"padding-top")),r=parseFloat(this.getCssStyle(e,"padding-bottom"));return s.subtract(t,n,r)},removeClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;r.trim(t).split(/\s+/).forEach(((e,t)=>{n.remove(e)}))},addClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;r.trim(t).split(/\s+/).forEach(((e,t)=>{n.add(e)}))},hasClass(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.classList;return r.trim(t).split(/\s+/).every(((e,t)=>n.contains(e)))},scrollTopBottomTrigger(e,t){"string"==typeof e&&e&&(e=document.body.querySelector(e));let n=window;this.isElement(e)&&e!=document.body&&e!=document.documentElement&&(n=e),"function"==typeof e&&(t=e);let r=!0;n.addEventListener("scroll",(e=>{if(this.getScrollTop(n)<=0){if(!r)return;"function"==typeof t&&(r=!1,t({state:"top",target:n}))}else{let e={state:"bottom",target:n},i=0;if(i=n==window?window.innerHeight:n.clientHeight,s.add(this.getScrollTop(n),i)+1>=this.getScrollHeight(n)&&i!=this.getScrollHeight(n)){if(!r)return;"function"==typeof t&&(r=!1,t(e))}else r=!0}}))},getScrollWidth(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollWidth:0==document.documentElement.scrollWidth||0==document.body.scrollWidth?document.documentElement.scrollWidth||document.body.scrollWidth:document.documentElement.scrollWidth>document.body.scrollWidth?document.documentElement.scrollWidth:document.body.scrollWidth,t},getScrollHeight(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollHeight:0==document.documentElement.scrollHeight||0==document.body.scrollHeight?document.documentElement.scrollHeight||document.body.scrollHeight:document.documentElement.scrollHeight>document.body.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight,t},setScrollTop(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let r=e.number||0,i=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise(((e,o)=>{if(i<=0)t?document.documentElement.scrollTop=document.body.scrollTop=r:n.scrollTop=r,e();else{let o=10,a=s.divide(i,o),l=this.getScrollTop(n),h=s.divide(s.subtract(r,l),a),c=setInterval((()=>{a>0?(a--,t?document.documentElement.scrollTop=document.body.scrollTop=l=s.add(l,h):n.scrollTop=l=s.add(l,h)):(clearInterval(c),e())}),o)}}))},getScrollTop(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollTop:0==document.documentElement.scrollTop||0==document.body.scrollTop?document.documentElement.scrollTop||document.body.scrollTop:document.documentElement.scrollTop>document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,t},getScrollLeft(e){"string"==typeof e&&e&&(e=document.body.querySelector(e));let t=0;return t=this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollLeft:0==document.documentElement.scrollLeft||0==document.body.scrollLeft?document.documentElement.scrollLeft||document.body.scrollLeft:document.documentElement.scrollLeft>document.body.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,t},setScrollLeft(e){let t=!1,n=e.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));let r=e.number||0,i=e.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(t=!0),new Promise(((e,o)=>{if(i<=0)t?document.documentElement.scrollLeft=document.body.scrollLeft=r:n.scrollLeft=r,e();else{let o=10,a=s.divide(i,o),l=this.getScrollLeft(n),h=s.divide(s.subtract(r,l),a),c=setInterval((()=>{a>0?(a--,t?document.documentElement.scrollLeft=document.body.scrollLeft=l=s.add(l,h):n.scrollLeft=l=s.add(l,h)):(clearInterval(c),e())}),o)}}))},getCssStyle(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n="";return n=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e)[t]:e.currentStyle[t],n},getCssSelector(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a selector string");if(/^#{1}/.test(e))return{type:"id",value:e.substr(1)};if(/^\./.test(e))return{type:"class",value:e.substr(1)};if(/^\[(.+)\]$/.test(e)){let t="attribute",n="",s=r.trim(e,!0).substring(1,r.trim(e,!0).length-1).split("=");return 1==s.length&&(n=s[0]),2==s.length&&(n={attributeName:s[0],attributeValue:s[1].replace(/\'/g,"").replace(/\"/g,"")}),{type:t,value:n}}return{type:"tag",value:e}},getElementBounding(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);let t=e.getBoundingClientRect();return{top:t.top,bottom:s.subtract(document.documentElement.clientHeight||window.innerHeight,t.bottom),left:t.left,right:s.subtract(document.documentElement.clientWidth||window.innerWidth,t.right)}},isElement:e=>e&&e instanceof Node&&1===e.nodeType,string2dom(e,t="div"){if(!e||"string"!=typeof e)throw new TypeError("The argument must be an HTML string");let n=document.createElement(t);return n.innerHTML=e,1==n.children.length?n.children[0]:n.children}},o="_dap-datas",a={remove(e,t){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[o]||{};null==t||""===t?e[o]={}:(delete n[t],e[o]=n)},has(e,t){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");return(e[o]||{}).hasOwnProperty(t)},get(e,t){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=e[o]||{};return null==t||""===t?n:n[t]},set(e,t,n){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");let s=e[o]||{};s[t]=n,e[o]=s}},l={matchingText(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=null;if("Chinese"==t&&(n=/^[\u4e00-\u9fa5]+$/),"chinese"==t&&(n=/[\u4e00-\u9fa5]/),"email"==t&&(n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/),"userName"==t&&(n=/^[a-zA-Z0-9_]{4,16}$/),"int+"==t&&(n=/^\d+$/),"int-"==t&&(n=/^-\d+$/),"int"==t&&(n=/^-?\d+$/),"pos"==t&&(n=/^\d*\.?\d+$/),"neg"==t&&(n=/^-\d*\.?\d+$/),"number"==t&&(n=/^-?\d*\.?\d+$/),"phone"==t&&(n=/^1[0-9]\d{9}$/),"idCard"==t&&(n=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/),"url"==t&&(n=/^((https?|ftp|file):\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/),"IPv4"==t&&(n=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/),"hex"==t&&(n=/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/),"date"==t){let t=/^(\d{4})(\/)(\d{2})(\/)(\d{2})$/,n=/^(\d{4})(\.)(\d{2})(\.)(\d{2})$/,s=/^(\d{4})(年)(\d{2})(月)(\d{2})(日)$/;return/^((\d{4})(-)(\d{2})(-)(\d{2}))$/.test(e)||t.test(e)||n.test(e)||s.test(e)}if("time"==t&&(n=/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/),"QQ"==t&&(n=/^[1-9][0-9]{4,10}$/),"weixin"==t&&(n=/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/),"plate"==t&&(n=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/),!n)throw new Error("The second parameter is out of scope");return n.test(e)},getUrlParams(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");let t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1);if(!n){let e=window.location.hash.split("?");2==e.length&&(n=e[1])}let s=n.match(t);return s?decodeURIComponent(s[2]):null},isEmptyObject(e){return!!this.isObject(e)&&0==Object.keys(e).length},equal(e,t){if(typeof e!=typeof t)return!1;if(this.isObject(e)&&this.isObject(t)){e=Object.assign({},e),t=Object.assign({},t);let n=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(n.length!=s.length)return!1;let r=n.length;for(let i=0;i<r;i++){let s=n[i],r=e[s],o=t[s];if(this.isObject(r))return!!this.equal(r,o);if(r!==o)return!1}return!0}return e===t},isObject:e=>!("object"!=typeof e||!e),copyText(e){if(!e||"string"!=typeof e)throw new TypeError("No text to copy is defined");let t=i.string2dom('<input type="text" />');document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}},h=e=>{let t=e.split(/[\s]+/g),n=[];return t.forEach((e=>{let t=e.split("."),s={eventName:t[0]};t.length>1&&(s.guid=t[1]),n.push(s)})),n},c=(e,t,n)=>{let s=a.get(e,"dap-defined-events")||{},r=Object.keys(s),i=r.length;for(let o=0;o<i;o++){let i=r[o];s[i].type==t&&(n?i==t+"."+n&&(e.removeEventListener(s[i].type,s[i].fn,s[i].options),s[i]=void 0):(e.removeEventListener(s[i].type,s[i].fn,s[i].options),s[i]=void 0))}s=(e=>{let t={};return Object.keys(e).forEach((n=>{e[n]&&(t[n]=e[n])})),t})(s),a.set(e,"dap-defined-events",s)},m={on(e,t,n,s){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!n||"function"!=typeof n)throw new TypeError("The third argument must be a function");l.isObject(s)||(s={});h(t).forEach((t=>{((e,t,n,s,r)=>{let i=a.get(e,"dap-defined-events")||{};n||(n=a.get(e,"dap-event-guid")||0,a.set(e,"dap-event-guid",n+1)),i[n=t+"."+n]&&i[n].type==t&&e.removeEventListener(t,i[n].fn,i[n].options),e.addEventListener(t,s,r),i[n]={type:t,fn:s,options:r},a.set(e,"dap-defined-events",i)})(e,t.eventName,t.guid,n.bind(e),s)}))},off(e,t){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let n=a.get(e,"dap-defined-events");if(!n)return;if(!t){let t=Object.keys(n),s=t.length;for(let r=0;r<s;r++){let s=t[r];e.removeEventListener(n[s].type,n[s].fn,n[s].options)}return a.remove(e,"dap-defined-events"),void a.remove(e,"dap-event-guid")}h(t).forEach((t=>{c(e,t.eventName,t.guid)}))},get(e){if(!(e instanceof Document||i.isElement(e)||i.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");let t=a.get(e,"dap-defined-events");if(t)return t}},d={getPrevMonths(e,t){e&&e instanceof Date||(e=new Date),s.isNumber(t)||(t=1);let n=[e];for(let s=0;s<t-1;s++){let t=e.getFullYear(),s=e.getMonth();0==s&&(s=12,t--);let r=new Date;r.setMonth(s-1),r.setFullYear(t),n.push(r),e=r}return n},getNextMonths(e,t){e&&e instanceof Date||(e=new Date),s.isNumber(t)||(t=1);let n=[e];for(let s=0;s<t-1;s++){let t=e.getFullYear(),s=e.getMonth();11==s&&(s=-1,t++);let r=new Date;r.setMonth(s+1),r.setFullYear(t),n.push(r),e=r}return n},getDateAfter:(e,t)=>(e&&e instanceof Date||(e=new Date),s.isNumber(t)||(t=1),new Date(e.getTime()+24*t*60*60*1e3)),getDateBefore:(e,t)=>(e&&e instanceof Date||(e=new Date),s.isNumber(t)||(t=1),new Date(e.getTime()-24*t*60*60*1e3)),getDays(e,t){if(!s.isNumber(e))throw new TypeError("The first parameter must be a number representing the year");if(!s.isNumber(t))throw new TypeError("The second argument must be a number representing the month");return e=parseInt(e),t=parseInt(t),new Date(e,t,0).getDate()}},u={rgb2hsv(e){if(!Array.isArray(e)||3!=e.length)throw new TypeError("Invalid argument");let t=0,n=0,s=0,r=e[0]>=255?255:e[0],i=e[1]>=255?255:e[1],o=e[2]>=255?255:e[2];r=r<=0?0:r,i=i<=0?0:i,o=o<=0?0:o;let a=Math.max(r,i,o),l=Math.min(r,i,o);return s=a/255,n=0===a?0:1-l/a,a===l?t=0:a===r&&i>=o?t=(i-o)/(a-l)*60+0:a===r&&i<o?t=(i-o)/(a-l)*60+360:a===i?t=(o-r)/(a-l)*60+120:a===o&&(t=(r-i)/(a-l)*60+240),t=parseInt(t),n=parseInt(100*n),s=parseInt(100*s),[t,n,s]},hsv2rgb(e){if(!Array.isArray(e)||3!=e.length)throw new TypeError("Invalid argument");let t=e[0]>=360||e[0]<=0?0:e[0],n=e[1]>=100?100:e[1];n=n<=0?0:n;let s=e[2]>=100?100:e[2];s=s<=0?0:s,n/=100,s/=100;let r=0,i=0,o=0,a=parseInt(t/60%6),l=t/60-a,h=s*(1-n),c=s*(1-l*n),m=s*(1-(1-l)*n);switch(a){case 0:r=s,i=m,o=h;break;case 1:r=c,i=s,o=h;break;case 2:r=h,i=s,o=m;break;case 3:r=h,i=c,o=s;break;case 4:r=m,i=h,o=s;break;case 5:r=s,i=h,o=c}return r=parseInt(255*r),i=parseInt(255*i),o=parseInt(255*o),[r,i,o]},rgb2hex(e){if(!Array.isArray(e)||3!=e.length)throw new TypeError("Invalid argument");return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)},hex2rgb(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");let t=e.toLowerCase();if(!l.matchingText(t,"hex"))throw new TypeError("The argument must be a hexadecimal color value");if(4===t.length){let e="#";for(let n=1;n<4;n+=1)e+=t.slice(n,n+1).concat(t.slice(n,n+1));t=e}let n=[];for(let s=1;s<7;s+=2)n.push(parseInt("0x"+t.slice(s,s+2)));return n}},f={start(e,t){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");let n={pitch:.8,rate:1,volume:1,start:function(){},end:function(){},pause:function(){},resume:function(){},error:function(){}};l.isObject(t)||(t={}),s.isNumber(t.pitch)&&(n.pitch=t.pitch),s.isNumber(t.rate)&&(n.rate=t.rate),s.isNumber(t.volume)&&(n.volume=t.volume),"function"==typeof t.start&&(n.start=t.start),"function"==typeof t.end&&(n.end=t.end),"function"==typeof t.pause&&(n.pause=t.pause),"function"==typeof t.resume&&(n.resume=t.resume),"function"==typeof t.error&&(n.error=t.error);const r=new SpeechSynthesisUtterance;r.text=e,r.pitch=n.pitch,r.rate=n.rate,r.volume=n.volume,r.lang="zh-CN",r.onstart=t=>{n.start.apply(r,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},r.onend=t=>{n.end.apply(r,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},r.onpause=t=>{n.pause.apply(r,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},r.onresume=t=>{n.resume.apply(r,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},r.onerror=t=>{n.error.apply(r,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},window.speechSynthesis.speak(r)},stop(){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");window.speechSynthesis.cancel()},pause(){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");window.speechSynthesis.pause()},resume(){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");window.speechSynthesis.resume()}},g={number:s,data:a,element:i,event:m,common:l,date:d,color:u,file:{getImageUrl(e){if(!(e&&e instanceof File))throw new TypeError("The argument must be a File object");return window.URL.createObjectURL(e)},dataFileToBase64:e=>new Promise(((t,n)=>{e&&e instanceof File||n(new TypeError("The argument must be a File object"));let s=new FileReader;s.readAsDataURL(e),s.onloadend=()=>{let e=s.result;t(e)}})),dataBase64toFile(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");let n=e.split(","),s=n[0].match(/:(.*?);/)[1],r=atob(n[1]),i=r.length,o=new Uint8Array(i);for(;i--;)o[i]=r.charCodeAt(i);return new File([o],t,{type:s})}},string:r,platform:{language:()=>window.navigator.browserLanguage||window.navigator.language,device(){const e=window.navigator.userAgent;return{PC:!e.match(/AppleWebKit.*Mobile.*/),Mobile:!!e.match(/AppleWebKit.*Mobile.*/),iPhone:e.includes("iPhone"),Phone:e.includes("Android")&&/(?:Mobile)/.test(e)||e.includes("iPhone")||/(?:Windows Phone)/.test(e),iPad:e.includes("iPad"),Tablet:e.includes("iPad")||e.includes("Android")&&!/(?:Mobile)/.test(e)||e.includes("Firefox")&&/(?:Tablet)/.test(e),WindowsPhone:/(?:Windows Phone)/.test(e)}},browser(){const e=window.navigator.userAgent;return{Edge:!!e.match(/Edg\/([\d.]+)/),weixin:e.includes("MicroMessenger"),QQ:e.includes("QQ"),QQBrowser:e.includes("MQQBrowser"),UC:e.includes("UCBrowser"),Chrome:e.includes("Chrome"),Firefox:e.includes("Firefox"),sougou:e.toLocaleLowerCase().includes("se 2.x")||e.toLocaleLowerCase().includes("metasr")||e.toLocaleLowerCase().includes("sogou"),Safari:e.includes("Safari")&&!e.includes("Chrome")}},browserKernel(){const e=window.navigator.userAgent;return e.includes("Presto")?"opera":e.includes("AppleWebKit")?"webkit":e.includes("Gecko")&&!e.includes("KHTML")?"gecko":""},os(){const e=window.navigator.userAgent;return{Windows:e.includes("Windows"),Windows_CPU:e.toLocaleLowerCase().includes("win64")||e.toLocaleLowerCase().includes("wow64")?"x64":e.toLocaleLowerCase().includes("win32")||e.toLocaleLowerCase().includes("wow32")?"x32":"",Windows_Version:e.includes("Windows NT 6.1")||e.includes("Windows 7")?"Win7":e.includes("Windows NT 6.3")||e.includes("Windows NT 6.2")||e.includes("Windows NT 8")?"Win8":e.includes("Windows NT 10")||e.includes("Windows NT 6.4")?"Win10":"",Mac:e.includes("Macintosh"),Mac_Version:function(){if(e.includes("Macintosh")){const t=e.match(/Mac OS X ([^\s]+)\)/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ios_Version:function(){if(e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){const t=e.match(/CPU.+OS ([^\s]+) like Mac OS X/);if(t&&t[1])return t[1].split(/_|\./).join(".")}return""}(),Android:e.includes("Android"),Android_Version:function(){const t=e.match(/Android ([^\s]+);/);return t&&t[1]?t[1].split(/_|\./).join("."):""}(),Linux:e.includes("Linux"),HarmonyOS:e.includes("HarmonyOS"),Ubuntu:e.includes("Ubuntu")}}},speech:f},p={getAttributes(e){let t={};for(let n of e.attributes)/(^on)|(^style$)|(^contenteditable$)/g.test(n.nodeName)||(t[n.nodeName]=n.nodeValue);return t},getStyles(e){let t={};if(e.getAttribute("style")){const n=e.getAttribute("style").split(";").filter((e=>e));for(let e of n){const n=e.split(":"),s=n[0].trim(),r=n[1].trim();t[s]=r}}return t},getUniqueKey(){let e=g.data.get(window,"data-alex-editor-key")||0;return e++,g.data.set(window,"data-alex-editor-key",e),e},isSpaceText:e=>/^[\uFEFF]+$/g.test(e),clone:e=>g.common.isObject(e)||Array.isArray(e)?JSON.parse(JSON.stringify(e)):e,isContains:(e,t)=>3==t.nodeType?g.element.isContains(e,t.parentNode):g.element.isContains(e,t),blobToBase64:e=>new Promise((t=>{const n=new FileReader;n.onload=e=>{t(e.target.result)},n.readAsDataURL(e)})),createGuid(){let e=g.data.get(document.documentElement,"mvi-editor-guid")||0;return e++,g.data.set(document.body,"mvi-editor-guid",e),e}},y=class{constructor(e,t,n,s,r){this.key=p.getUniqueKey(),this.type=e,this.parsedom=t,this.marks=n,this.styles=s,this.textContent=r,this.children=null,this.parent=null,this.behavior="default",this._elm=null}isBlock(){return"block"==this.type}isInblock(){return"inblock"==this.type}isInline(){return"inline"==this.type}isClosed(){return"closed"==this.type}isText(){return"text"==this.type}isBreak(){return this.isClosed()&&"br"==this.parsedom}isEmpty(){if(this.isText())return!this.textContent;if(this.isBlock()||this.isInblock()||this.isInline()){if(!this.hasChildren())return!0;return this.children.every((e=>!e||e.isEmpty()))}return!1}isSpaceText(){return this.isText()&&!this.isEmpty()&&p.isSpaceText(this.textContent)}isEqual(e){return!!y.isElement(e)&&this.key==e.key}isContains(e){return!!this.isEqual(e)||!e.isBlock()&&this.isContains(e.parent)}isOnlyHasBreak(){return!!this.hasChildren()&&this.children.every((e=>e.isBreak()||e.isEmpty()))}isPreStyle(){const e=this.getBlock(),t=this.getInblock();return t?"pre"==t.parsedom||(!(!t.hasStyles()||"pre"!=t.styles["white-space"]&&"pre-wrap"!=t.styles["white-space"])||t.parent.isPreStyle()):"pre"==e.parsedom||!(!e.hasStyles()||"pre"!=e.styles["white-space"]&&"pre-wrap"!=e.styles["white-space"])}hasMarks(){return!!this.marks&&(!!g.common.isObject&&!g.common.isEmptyObject(this.marks))}hasStyles(){return!!this.styles&&(!!g.common.isObject(this.styles)&&!g.common.isEmptyObject(this.styles))}hasChildren(){return!this.isClosed()&&!this.isText()&&(!!Array.isArray(this.children)&&!!this.children.length)}hasContains(e){return this.isContains(e)||e.isContains(this)}clone(e=!0){if("boolean"!=typeof e)throw new Error("The parameter must be a Boolean");let t=new y(this.type,this.parsedom,p.clone(this.marks),p.clone(this.styles),this.textContent);return t.behavior=this.behavior,e&&this.hasChildren()&&this.children.forEach((n=>{let s=n.clone(e);t.hasChildren()?t.children.push(s):t.children=[s],s.parent=t})),t}convertToBlock(){if(this.isBlock())throw new Error('This element is already of type "block"');let e=this.clone();this.type="block",this.parsedom=y.BLOCK_NODE,this.marks=null,this.styles=null,this.textContent=null,this.children=[e],e.parent=this}toEmpty(){this.isEmpty()||(this.isText()?(this.marks=null,this.styles=null,this.textContent=null,this._elm=null):this.isClosed()?(this.type="text",this.parsedom=null,this.marks=null,this.styles=null,this.textContent=null,this._elm=null):this.hasChildren()&&this.children.forEach((e=>{e.toEmpty()})))}getBlock(){return this.isBlock()?this:this.parent.getBlock()}getInblock(){return this.isInblock()?this:this.isBlock()?null:this.parent.getInblock()}getInline(){return this.isInline()?this:this.isBlock()?null:this.parent.getInline()}isEqualStyles(e){return!this.hasStyles()&&!e.hasStyles()||!!(this.hasStyles()&&e.hasStyles()&&g.common.equal(this.styles,e.styles))}isEqualMarks(e){return!this.hasMarks()&&!e.hasMarks()||!!(this.hasMarks()&&e.hasMarks()&&g.common.equal(this.marks,e.marks))}__renderElement(){let e=null;if(this.isText()){e=document.createElement(y.TEXT_NODE);const t=document.createTextNode(this.textContent);e.appendChild(t)}else if(e=document.createElement(this.parsedom),this.hasChildren())for(let t of this.children)t.__renderElement(),e.appendChild(t._elm);if(this.hasMarks())for(let t in this.marks)/(^on)|(^style$)|(^contenteditable$)/g.test(t)||e.setAttribute(t,this.marks[t]);if(this.hasStyles())for(let t in this.styles)e.style.setProperty(t,this.styles[t]);g.data.set(e,"data-alex-editor-key",this.key),this._elm=e}__fullClone(){let e=new y(this.type,this.parsedom,p.clone(this.marks),p.clone(this.styles),this.textContent);return e.behavior=this.behavior,e.key=this.key,e._elm=this._elm,this.hasChildren()&&this.children.forEach((t=>{let n=t.__fullClone();e.hasChildren()?e.children.push(n):e.children=[n],n.parent=e})),e}__getLink(){return"a"==this.parsedom?this:this.isBlock()?null:this.parent.__getLink()}static isElement(e){return e instanceof y}static flatElements(e){const t=e=>{let n=[];return e.forEach((e=>{if(y.isElement(e)&&(n.push(e),e.hasChildren())){let s=t(e.children);n=[...n,...s]}})),n};return t(e)}static getSpaceElement(){return new y("text",null,null,null,"\ufeff")}};let E=y;n(E,"BLOCK_NODE","p"),n(E,"TEXT_NODE","span"),n(E,"VOID_NODES",["colgroup","col"]);class b{constructor(e,t){this.element=e,this.offset=t,this._init()}_init(){this.element.isText()||this.element.isClosed()||(0==this.offset?this.moveToStart(this.element):this.moveToEnd(this.element))}static isPoint(e){return e instanceof b}isEqual(e){return!!b.isPoint(e)&&(this.element.isEqual(e.element)&&this.offset==e.offset)}moveToEnd(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=e.textContent.length;else if(e.isClosed())this.element=e,this.offset=1;else if(e.hasChildren()){const t=E.flatElements(e.children).filter((e=>!e.isEmpty())),n=t.length;this.moveToEnd(t[n-1])}}moveToStart(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=0;else if(e.isClosed())this.element=e,this.offset=0;else if(e.hasChildren()){const t=E.flatElements(e.children).filter((e=>!e.isEmpty()));this.moveToStart(t[0])}}}class w{constructor(e,t){this.anchor=e,this.focus=t}}class T{constructor(){this.records=[],this.current=-1}push(e,t){this.current<this.records.length-1&&(this.records.length=this.current+1);const n=e.map((e=>e.__fullClone())),s=E.flatElements(n).find((e=>e.key==t.anchor.element.key)),r=E.flatElements(n).find((e=>e.key==t.focus.element.key)),i=new b(s,t.anchor.offset),o=new b(r,t.focus.offset),a=new w(i,o);this.records.push({stack:n,range:a}),this.current+=1}get(e){if(-1==e){if(this.current<=0)return null;this.current-=1}else if(1==e){if(this.current>=this.records.length-1)return null;this.current+=1}const{stack:t,range:n}=this.records[this.current],s=t.map((e=>e.__fullClone())),r=E.flatElements(s).find((e=>e.key==n.anchor.element.key)),i=E.flatElements(s).find((e=>e.key==n.focus.element.key)),o=new b(r,n.anchor.offset),a=new b(i,n.focus.offset);return{stack:s,range:new w(o,a)}}}const{Mac:k}=g.platform.os(),v={Undo:e=>k?90==e.keyCode&&e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.altKey:90==e.keyCode&&e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey,Redo:e=>k?90==e.keyCode&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey:89==e.keyCode&&e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey,Indent:e=>!(9!=e.keyCode||e.metaKey||e.shiftKey||e.ctrlKey||e.altKey),Outdent:e=>9==e.keyCode&&!e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey},x={block:[{parsedom:"p"},{parsedom:"div"},{parsedom:"table"},{parsedom:"ul"},{parsedom:"ol"},{parsedom:"h1"},{parsedom:"h2"},{parsedom:"h3"},{parsedom:"h4"},{parsedom:"h5"},{parsedom:"h6"},{parsedom:"blockquote"},{parsedom:"pre"},{parsedom:"address",parse:!0},{parsedom:"article",parse:!0},{parsedom:"aside",parse:!0},{parsedom:"nav",parse:!0},{parsedom:"section",parse:!0}],inblock:[{parsedom:"li",block:!0},{parsedom:"tfoot"},{parsedom:"tbody"},{parsedom:"thead"},{parsedom:"tr"},{parsedom:"th"},{parsedom:"td"},{parsedom:"colgroup"}],inline:[{parsedom:"span"},{parsedom:"a"},{parsedom:"label"},{parsedom:"code"},{parsedom:"b",parse:{"font-weight":"bold"}},{parsedom:"strong",parse:{"font-weight":"bold"}},{parsedom:"sup",parse:{"vertical-align":"super"}},{parsedom:"sub",parse:{"vertical-align":"sub"}},{parsedom:"i",parse:{"font-style":"italic"}},{parsedom:"u",parse:{"text-decoration-line":"underline"}},{parsedom:"del",parse:{"text-decoration-line":"line-through"}},{parsedom:"abbr",parse:!0},{parsedom:"acronym",parse:!0},{parsedom:"bdo",parse:!0}],closed:[{parsedom:"br"},{parsedom:"col"},{parsedom:"img"},{parsedom:"hr"},{parsedom:"video"},{parsedom:"audio"}]};class _{constructor(e,t){if(n(this,"__formatUnchangeableRules",[e=>{e.parent||e.isBlock()||e.isEmpty()||e.convertToBlock()},e=>{if(e.hasChildren()){const t=e.children.some((e=>!e.isEmpty()&&e.isBlock()));t&&e.children.forEach((t=>{!t.isEmpty()&&t.isBlock()&&(t.type="inline"==e.type?"inline":"inblock")}))}},e=>{if(e.hasChildren()){let t=e.children.some((e=>!e.isEmpty()&&e.isInblock())),n=e.children.some((e=>!e.isEmpty()&&!e.isInblock()));t&&n&&e.children.forEach((e=>{!e.isEmpty()&&e.isInblock()&&(e.type="inline")}))}},e=>{if(e.isInline()&&e.hasChildren()){const t=e.children.some((e=>!e.isEmpty()&&e.isInblock()));t&&e.children.forEach((e=>{!e.isEmpty()&&e.isInblock()&&(e.type="inline")}))}},e=>{if(e.hasChildren())if(e.isBlock()||e.isInblock()){let t=e.children.some((e=>e.isBreak())),n=e.children.some((e=>!e.isEmpty()&&!e.isBreak()));t&&n?e.children.forEach((e=>{e.isBreak()&&e.toEmpty()})):t&&e.children.length>1&&e.children.forEach(((e,t)=>{e.isBreak()&&t>0&&e.toEmpty()}))}else e.isInline()&&e.children.forEach((e=>{e.isBreak()&&e.toEmpty()}))},e=>{const t=e=>{const n=(e,n)=>{if(e.isEmpty()||n.isEmpty()){if(n.isEmpty()){this.range&&n.isContains(this.range.anchor.element)&&(e.isEmpty()?(this.range.anchor.element=e,this.range.anchor.offset=0):this.range.anchor.moveToEnd(e)),this.range&&n.isContains(this.range.focus.element)&&(e.isEmpty()?(this.range.focus.element=e,this.range.focus.offset=0):this.range.focus.moveToEnd(e));const t=n.parent.children.findIndex((e=>n.isEqual(e)));n.parent.children.splice(t,1)}else if(e.isEmpty()){this.range&&e.isContains(this.range.anchor.element)&&(n.isEmpty()?(this.range.anchor.element=n,this.range.anchor.offset=0):this.range.anchor.moveToStart(n)),this.range&&e.isContains(this.range.focus.element)&&(n.isEmpty()?(this.range.focus.element=n,this.range.focus.offset=0):this.range.focus.moveToStart(n));const t=e.parent.children.findIndex((t=>e.isEqual(t)));e.parent.children.splice(t,1)}}else if(e.isText()){this.range&&n.isEqual(this.range.anchor.element)&&(this.range.anchor.element=e,this.range.anchor.offset=e.textContent.length+this.range.anchor.offset),this.range&&n.isEqual(this.range.focus.element)&&(this.range.focus.element=e,this.range.focus.offset=e.textContent.length+this.range.focus.offset),e.textContent||(e.textContent=""),n.textContent||(n.textContent=""),e.textContent+=n.textContent;const t=n.parent.children.findIndex((e=>n.isEqual(e)));n.parent.children.splice(t,1)}else if(e.isInline()){e.hasChildren()||(e.children=[]),n.hasChildren()||(n.children=[]),e.children.push(...n.children),e.children.forEach((t=>{t.parent=e})),t(e);const s=n.parent.children.findIndex((e=>n.isEqual(e)));n.parent.children.splice(s,1)}};if(e.hasChildren()&&e.children.length>1){let t=0;for(;t<=e.children.length-2;)s=e.children[t],r=e.children[t+1],s.isEmpty()||r.isEmpty()||(s.isText()&&r.isText()?s.isEqualStyles(r)&&s.isEqualMarks(r):s.isInline()&&r.isInline()&&s.parsedom==r.parsedom&&s.isEqualMarks(r)&&s.isEqualStyles(r))?n(e.children[t],e.children[t+1]):t++}var s,r};t(e)},e=>{const t=(e,t)=>{t.isText()?(e.type="text",e.parsedom=null,t.hasMarks()&&(e.hasMarks()?Object.assign(e.marks,p.clone(t.marks)):e.marks=p.clone(t.marks)),t.hasStyles()&&(e.hasStyles()?Object.assign(e.styles,p.clone(t.styles)):e.styles=p.clone(t.styles)),e.textContent=t.textContent,e.children=null,this.range&&t.isEqual(this.range.anchor.element)&&(this.range.anchor.element=e),this.range&&t.isEqual(this.range.focus.element)&&(this.range.focus.element=e)):(t.hasMarks()&&(e.hasMarks()?Object.assign(e.marks,p.clone(t.marks)):e.marks=p.clone(t.marks)),t.hasStyles()&&(e.hasStyles()?Object.assign(e.styles,p.clone(t.styles)):e.styles=p.clone(t.styles)),t.hasChildren()&&(e.children=[...t.children],e.children.forEach((t=>{t.parent=e}))))};var n,s;e.hasChildren()&&1==e.children.length&&(n=e,(s=e.children[0]).isText()&&n.isInline()?n.parsedom==E.TEXT_NODE:(n.isInline()&&s.isInline()||n.isInblock()&&s.isInblock())&&n.parsedom==s.parsedom)&&t(e,e.children[0])},e=>{e.isEmpty()&&(this.range&&e.isContains(this.range.anchor.element)&&this.__setRecentlyPoint(this.range.anchor),this.range&&e.isContains(this.range.focus.element)&&this.__setRecentlyPoint(this.range.focus))}]),"string"==typeof e&&e&&(e=document.body.querySelector(e)),!g.element.isElement(e))throw new Error("You must specify a dom container to initialize the editor");if(g.data.get(e,"data-alex-editor-init"))throw new Error("The element node has been initialized to the editor");g.data.set(e,"data-alex-editor-init",!0),t=this.__formatOptions(t),this.__guid=p.createGuid(),this.$el=e,this.disabled=t.disabled,this.value=t.value,this.renderRules=t.renderRules,this.htmlPaste=t.htmlPaste,this.range=null,this.history=new T,this.__events={},this.__oldValue=t.value,this.__isInputChinese=!1,this.stack=this.parseHtml(this.value),this.__oldStack=null,this.__initRange(),this.disabled?this.setDisabled():this.setEnabled(),this.useClipboard=!0,this.__judgeUseClipboard(),g.event.on(document,`selectionchange.alex_editor_${this.__guid}`,this.__handleSelectionChange.bind(this)),g.event.on(this.$el,"beforeinput.alex_editor",this.__handleBeforeInput.bind(this)),g.event.on(this.$el,"compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor",this.__handleChineseInput.bind(this)),g.event.on(this.$el,"keydown.alex_editor",this.__handleKeydown.bind(this)),g.event.on(this.$el,"cut.alex_editor",this.__handleCut.bind(this)),g.event.on(this.$el,"paste.alex_editor",this.__handlePaste.bind(this)),g.event.on(this.$el,"copy.alex_editor",this.__handleCopy.bind(this)),g.event.on(this.$el,"dragstart.alex_editor drop.alex_editor ",(e=>e.preventDefault())),g.event.on(this.$el,"focus.alex_editor",(()=>{this.emit("focus",this.value)})),g.event.on(this.$el,"blur.alex_editor",(()=>{this.emit("blur",this.value)}))}__formatOptions(e){let t={disabled:!1,renderRules:[],htmlPaste:!1,value:"<p><br></p>"};return g.common.isObject(e)&&("boolean"==typeof e.disabled&&(t.disabled=e.disabled),Array.isArray(e.renderRules)&&(t.renderRules=e.renderRules),"string"==typeof e.value&&e.value&&(t.value=e.value),"boolean"==typeof e.htmlPaste&&(t.htmlPaste=e.htmlPaste)),t}__initRange(){const e=this.stack[this.stack.length-1],t=new b(e,0),n=new b(e,0);this.range=new w(t,n),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}__rectifyRangeInBreak(){let e=!1;this.range.anchor.element.isBreak()&&1==this.range.anchor.offset&&(this.range.anchor.offset=0,e=!0),this.range.focus.element.isBreak()&&1==this.range.focus.offset&&(this.range.focus.offset=0,e=!0),e&&this.rangeRender()}__setRecentlyPoint(e){const t=this.getPreviousElementOfPoint(e),n=this.getNextElementOfPoint(e),s=e.element.getBlock(),r=e.element.getInblock();t&&r&&r.isContains(t)?e.moveToEnd(t):n&&r&&r.isContains(n)?e.moveToStart(n):t&&s.isContains(t)?e.moveToEnd(t):n&&s.isContains(n)?e.moveToStart(n):t?e.moveToEnd(t):e.moveToStart(n)}__judgeUseClipboard(){window.ClipboardItem||(this.useClipboard=!1),navigator.clipboard||(this.useClipboard=!1)}__emptyDefaultBehaviorInblock(e){e.isInblock()&&"default"==e.behavior&&e.hasChildren()&&e.children.forEach((e=>{if(e.isInblock())this.__emptyDefaultBehaviorInblock(e);else if(e.toEmpty(),e.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.parent)}}))}__cloneStack(){return this.stack.map((e=>e.__fullClone()))}__removeDeletedElementDom(){const e=t=>{t.forEach((t=>{const n=E.flatElements(this.stack).some((e=>e.isEqual(t)));n&&t.hasChildren()?e(t.children):n||t._elm.remove()}))};e(this.__oldStack)}__updateElementDom(){const e=t=>{t.forEach((t=>{const n=E.flatElements(this.__oldStack).find((e=>e.isEqual(t)));if(n)if(n.type!=t.type||n.parsedom!=t.parsedom)t.__renderElement(),n._elm.parentNode.insertBefore(t._elm,n._elm),n._elm.remove();else{if(!n.isEqualMarks(t)){if(n.hasMarks())for(let e in n.marks)t._elm.removeAttribute(e);if(t.hasMarks())for(let e in t.marks)/(^on)|(^style$)|(^contenteditable$)/g.test(e)||t._elm.setAttribute(e,t.marks[e])}if(!n.isEqualStyles(t)&&(t._elm.removeAttribute("style"),t.hasStyles()))for(let e in t.styles)t._elm.style.setProperty(e,t.styles[e]);if(t.isText()&&n.textContent!=t.textContent){t._elm.innerHTML="";const e=document.createTextNode(t.textContent);t._elm.appendChild(e)}t.parent&&n.parent&&!t.parent.isEqual(n.parent)&&this.__insertNewDom(t,!1),t.hasChildren()&&e(t.children)}else n||this.__insertNewDom(t)}))};e(this.stack)}__insertNewDom(e,t=!0){t&&e.__renderElement();const n=this.getPreviousElement(e);if(n)n._elm.parentNode.insertBefore(e._elm,n._elm.nextSibling);else if(e.isBlock())this.$el.firstElementChild?this.$el.insertBefore(e._elm,this.$el.firstElementChild):this.$el.appendChild(e._elm);else{const t=e.parent._elm;t.firstElementChild?t.insertBefore(e._elm,t.firstElementChild):t.appendChild(e._elm)}}__filterIllegalDom(){const e=t=>{Array.from(t.childNodes).forEach((t=>{if(1==t.nodeType){const n=g.data.get(t,"data-alex-editor-key");if(n){this.getElementByKey(n)?e(t):t.remove()}else t.remove()}else if(3==t.nodeType){const e=t.parentNode,n=g.data.get(e,"data-alex-editor-key");if(n){const e=this.getElementByKey(n);e&&e.isText()||t.remove()}else t.remove()}else t.remove()}))};e(this.$el)}__safariLinkHandle(){const{Safari:e}=g.platform.browser(),t=this.range.anchor.element.__getLink();if(e&&t){if(t.hasChildren()){const e=E.flatElements(t.children);for(let t=e.length-1;t>=0;t--)e[t]._elm.remove()}t._elm.remove(),this.__insertNewDom(t)}}__handleSelectionChange(){if(this.disabled)return;if(this.__isInputChinese)return;const e=window.getSelection();if(e.rangeCount){const t=e.getRangeAt(0);if(p.isContains(this.$el,t.startContainer)&&p.isContains(this.$el,t.endContainer)){let e=null,n=null,s=null,r=null;if(3==t.startContainer.nodeType)e=t.startContainer.parentNode,s=t.startOffset;else if(1==t.startContainer.nodeType){const n=Array.from(t.startContainer.childNodes);n.length?(e=n[t.startOffset]?n[t.startOffset]:n[t.startOffset-1],s=n[t.startOffset]?0:1,3==e.nodeType&&(s=0==s?0:e.textContent.length,e=e.parentNode)):(e=t.startContainer,s=0)}if(3==t.endContainer.nodeType)n=t.endContainer.parentNode,r=t.endOffset;else if(1==t.endContainer.nodeType){const e=Array.from(t.endContainer.childNodes);e.length?(n=e[t.endOffset]?e[t.endOffset]:e[t.endOffset-1],r=e[t.endOffset]?0:1,3==n.nodeType&&(r=0==r?0:n.textContent.length,n=n.parentNode)):(n=t.endContainer,r=1)}const i=g.data.get(e,"data-alex-editor-key"),o=g.data.get(n,"data-alex-editor-key"),a=this.getElementByKey(i),l=this.getElementByKey(o),h=new b(a,s),c=new b(l,r);this.range=new w(h,c),this.__rectifyRangeInBreak(),this.emit("rangeUpdate",this.range)}}}__handleBeforeInput(e){this.disabled||"deleteByCut"!=e.inputType&&"insertFromPaste"!=e.inputType&&"deleteByDrag"!=e.inputType&&"insertFromDrop"!=e.inputType&&"insertCompositionText"!=e.inputType&&(e.preventDefault(),"insertText"==e.inputType&&e.data?(this.insertText(e.data),this.formatElementStack(),this.domRender(),this.rangeRender()):"insertParagraph"==e.inputType||"insertLineBreak"==e.inputType?(this.insertParagraph(),this.formatElementStack(),this.domRender(),this.rangeRender()):"deleteContentBackward"==e.inputType&&(this.delete(),this.formatElementStack(),this.domRender(),this.rangeRender()))}__handleChineseInput(e){this.disabled||(e.preventDefault(),"compositionstart"==e.type?this.__isInputChinese=!0:"compositionend"==e.type&&(e.data&&(this.insertText(e.data),this.formatElementStack(),this.__safariLinkHandle(),this.domRender(),this.rangeRender()),setTimeout((()=>{this.__isInputChinese=!1}),0)))}__handleKeydown(e){if(!this.disabled)if(v.Undo(e)){e.preventDefault();const t=this.history.get(-1);t&&(this.stack=t.stack,this.range=t.range,this.formatElementStack(),this.domRender(!0),this.rangeRender())}else if(v.Redo(e)){e.preventDefault();const t=this.history.get(1);t&&(this.stack=t.stack,this.range=t.range,this.formatElementStack(),this.domRender(!0),this.rangeRender())}else v.Indent(e)?(e.preventDefault(),this.setIndent()):v.Outdent(e)&&(e.preventDefault(),this.setOutdent())}async __handleCut(e){e.preventDefault();await this.cut()&&(this.formatElementStack(),this.domRender(),this.rangeRender())}async __handlePaste(e){e.preventDefault(),await this.paste(),this.formatElementStack(),this.domRender(),this.rangeRender()}async __handleCopy(e){e.preventDefault();await this.copy()&&(this.formatElementStack(),this.domRender(),this.rangeRender())}async paste(){if(!this.useClipboard)return!1;const e=(await navigator.clipboard.read())[0],t=[];for(const i of e.types)t.push(e.getType(i));const n=await Promise.all(t),s=n.every((e=>e.type.startsWith("image/"))),r=n.every((e=>e.type.startsWith("video/")));for(let i of n)if(s&&i.type.startsWith("image/")){const e=await p.blobToBase64(i);if(!this.emit("pasteImage",e)){const t=new E("closed","img",{src:e},null,null);this.insertElement(t)}}else if(r&&i.type.startsWith("video/")){const e=await p.blobToBase64(i);if(!this.emit("pasteVideo",e)){const t=new E("closed","video",{src:e},null,null);this.insertElement(t)}}else if("text/plain"==i.type){if(!this.htmlPaste){const e=await i.text();e&&(this.insertText(e),this.emit("paste",e))}}else if("text/html"==i.type&&this.htmlPaste){const e=await i.text();if(e){const t=this.parseHtml(e).filter((e=>!e.isEmpty()));for(let e=0;e<t.length;e++)this.insertElement(t[e],!1);this.emit("paste",e)}}}async cut(){if(!this.useClipboard)return!1;const e=await this.copy();return e&&(this.delete(),this.emit("cut")),e}async copy(){if(!this.useClipboard)return!1;const e=this.getElementsByRange(!0,!1);if(0==e.length)return!1;let t=0;for(;t<e.length;)if(e[t].isBlock())t++;else{if(e.some((n=>n.isEqual(e[t].parent))))t++;else{if(e[t].parent.children.every((t=>e.some((e=>e.isEqual(t)))))){const n=e.findIndex((n=>n.isEqual(e[t])));e.splice(n,0,e[t].parent)}else t++}}let n=[];e.forEach((t=>{if(t.isBlock())n.push(t);else{e.some((e=>e.isEqual(t.parent)))||n.push(t)}}));let s="",r="";n.forEach((e=>{const t=e.clone();t.__renderElement(),s+=t._elm.outerHTML,r+=t._elm.innerText}));const i=new window.ClipboardItem({"text/html":new Blob([s],{type:"text/html"}),"text/plain":new Blob([r],{type:"text/plain"})});return await navigator.clipboard.write([i]),this.emit("copy"),!0}delete(){if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.range.anchor.element.getBlock(),n=this.range.anchor.element.getInblock();if(n)if(0==this.range.anchor.offset)if(e){if(n.isContains(e))return this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),void this.delete();if("block"==n.behavior){const t=e.getBlock(),s=e.getInblock();s?"block"==s.behavior&&this.mergeBlockElement(n,s):this.mergeBlockElement(n,t)}}else this.emit("deleteInStart",n);else if(this.range.anchor.element.isSpaceText()){if(this.range.anchor.element.toEmpty(),!n.isEmpty())return this.range.anchor.offset=0,this.range.focus.offset=0,void this.delete();{const e=new E("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else if(this.range.anchor.element.isText()){const e=this.range.anchor.element.textContent;this.range.anchor.offset-=1;const t=p.isSpaceText(e[this.range.anchor.offset]);if(this.range.anchor.element.textContent=e.substring(0,this.range.anchor.offset)+e.substring(this.range.focus.offset),this.range.focus.offset=this.range.anchor.offset,t)return void this.delete();if(n.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const t=this.range.anchor.element.isBreak();if(this.range.anchor.element.toEmpty(),n.isEmpty())if(t&&"default"!=n.behavior){if(!e){const e=new E("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const e=new E("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else if(0==this.range.anchor.offset)if(e){if(t.isContains(e))return this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),void this.delete();{const n=e.getInblock(),s=e.getBlock();n?"block"==n.behavior&&this.mergeBlockElement(t,n):this.mergeBlockElement(t,s)}}else this.emit("deleteInStart",t);else if(this.range.anchor.element.isSpaceText()){if(this.range.anchor.element.toEmpty(),!t.isEmpty())return this.range.anchor.offset=0,this.range.focus.offset=0,void this.delete();{const e=new E("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else if(this.range.anchor.element.isText()){const e=this.range.anchor.element.textContent;this.range.anchor.offset-=1;const n=p.isSpaceText(e[this.range.anchor.offset]);if(this.range.anchor.element.textContent=e.substring(0,this.range.anchor.offset)+e.substring(this.range.focus.offset),this.range.focus.offset=this.range.anchor.offset,n)return void this.delete();if(t.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const n=this.range.anchor.element.isBreak();if(this.range.anchor.element.toEmpty(),t.isEmpty())if(n){if(!e){const e=new E("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}else{const e=new E("closed","br",null,null,null);this.addElementTo(e,t),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}}}else{const e=this.getElementsByRange(!0,!1).filter((e=>!E.VOID_NODES.includes(e.parsedom))),t=this.range.anchor.element.getInblock(),n=this.range.focus.element.getInblock(),s=this.range.anchor.element.getBlock(),r=this.range.focus.element.getBlock();t&&n&&t.isEqual(n)?e.forEach((e=>{if(e.toEmpty(),t.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,t)}})):t&&n?(e.forEach((e=>{if(e.isInblock()&&"default"==e.behavior)this.__emptyDefaultBehaviorInblock(e);else if(e.toEmpty(),e.parent&&(e.parent.isInblock()||e.parent.isBlock())&&e.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.parent)}})),"block"==t.behavior&&"block"==n.behavior&&this.mergeBlockElement(n,t)):t?(e.forEach((e=>{if(e.isInblock()&&"default"==e.behavior)this.__emptyDefaultBehaviorInblock(e);else if(e.toEmpty(),e.parent&&(e.parent.isInblock()||e.parent.isBlock())&&e.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.parent)}})),"block"==t.behavior&&this.mergeBlockElement(r,t)):n?(e.forEach((e=>{if(e.isInblock()&&"default"==e.behavior)this.__emptyDefaultBehaviorInblock(e);else if(e.toEmpty(),e.parent&&(e.parent.isInblock()||e.parent.isBlock())&&e.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.parent)}})),"block"==n.behavior&&this.mergeBlockElement(n,s)):s.isEqual(r)?e.forEach((e=>{if(e.toEmpty(),s.isEmpty()){const e=new E("closed","br",null,null,null);this.addElementTo(e,s)}})):(e.forEach((e=>{if(e.isInblock()&&"default"==e.behavior)this.__emptyDefaultBehaviorInblock(e);else if(e.toEmpty(),e.parent&&(e.parent.isInblock()||e.parent.isBlock())&&e.parent.isEmpty()){const t=new E("closed","br",null,null,null);this.addElementTo(t,e.parent)}})),this.mergeBlockElement(r,s))}this.range.anchor.element.isEmpty()&&this.__setRecentlyPoint(this.range.anchor),this.range.focus.element=this.range.anchor.element,this.range.focus.offset=this.range.anchor.offset}insertText(e){if(!e||"string"!=typeof e)throw new Error("The argument must be a string");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.isPreStyle()||(e=e.replace(/\s/g,(()=>{const e=document.createElement("span");return e.innerHTML="&nbsp;",e.innerText}))),this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset)+e+t.substring(this.range.anchor.offset),this.range.anchor.offset=this.range.anchor.offset+e.length,this.range.focus.offset=this.range.anchor.offset}else{const t=new E("text",null,null,null,e);0==this.range.anchor.offset?this.addElementBefore(t,this.range.anchor.element):this.addElementAfter(t,this.range.anchor.element),this.range.anchor.moveToEnd(t),this.range.focus.moveToEnd(t)}else this.delete(),this.insertText(e)}insertParagraph(){if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.getNextElementOfPoint(this.range.anchor),n=this.range.anchor.element.getBlock(),s=this.range.anchor.element.getInblock(),r=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(s){if(this.range.anchor.element.isPreStyle())this.range.anchor.element.isBreak()?(this.insertText("\n\n"),this.range.anchor.offset-=1,this.range.focus.offset-=1):this.range.anchor.offset!=r||t&&s.isContains(t)||this.range.anchor.element.isText()&&"\n"==this.range.anchor.element.textContent[this.range.anchor.offset-1]?this.insertText("\n"):(this.insertText("\n\n"),this.range.anchor.offset-=1,this.range.focus.offset-=1),this.emit("insertParagraph",null,s);else if("block"==s.behavior)if(0!=this.range.anchor.offset||e&&s.isContains(e))if(this.range.anchor.offset!=r||t&&s.isContains(t)){const e=s.clone();this.addElementAfter(e,s);const t=E.flatElements(s.children).findIndex((e=>this.range.anchor.element.isEqual(e)));this.range.focus.moveToEnd(s),this.delete();const n=E.flatElements(e.children);this.range.focus.element=n[t],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(e),this.delete(),this.emit("insertParagraph",e,s)}else{const e=s.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,s),this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t),this.emit("insertParagraph",e,s)}else{const e=s.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,s),this.emit("insertParagraph",s,e)}}else if(this.range.anchor.element.isPreStyle())this.range.anchor.element.isBreak()?(this.insertText("\n\n"),this.range.anchor.offset-=1,this.range.focus.offset-=1):this.range.anchor.offset!=r||t&&n.isContains(t)||this.range.anchor.element.isText()&&"\n"==this.range.anchor.element.textContent[this.range.anchor.offset-1]?this.insertText("\n"):(this.insertText("\n\n"),this.range.anchor.offset-=1,this.range.focus.offset-=1),this.emit("insertParagraph",null,n);else if(0!=this.range.anchor.offset||e&&n.isContains(e))if(this.range.anchor.offset!=r||t&&n.isContains(t)){const e=n.clone();this.addElementAfter(e,n);const t=E.flatElements(n.children).findIndex((e=>this.range.anchor.element.isEqual(e)));this.range.focus.moveToEnd(n),this.delete();const s=E.flatElements(e.children);this.range.focus.element=s[t],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(e),this.delete(),this.emit("insertParagraph",e,n)}else{const e=n.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,n),this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t),this.emit("insertParagraph",e,n)}else{const e=n.clone(!1),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,n),this.emit("insertParagraph",n,e)}}else this.delete(),this.insertParagraph()}insertElement(e,t=!0){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(!e.isEmpty())if(this.range.anchor.isEqual(this.range.focus)){const n=this.getPreviousElementOfPoint(this.range.anchor),s=this.getNextElementOfPoint(this.range.anchor),r=this.range.anchor.element.getBlock(),i=this.range.anchor.element.getInblock(),o=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(e.isInblock()&&"block"==e.behavior&&i&&"block"==i.behavior)if(i.isOnlyHasBreak()&&t)this.addElementBefore(e,i),i.toEmpty();else if(0!=this.range.anchor.offset||n&&i.isContains(n))if(this.range.anchor.offset!=o||s&&i.isContains(s)){const t=i.clone();this.addElementAfter(t,i),this.range.focus.moveToEnd(i),this.delete();const n=E.flatElements(i.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementBefore(e,t)}else this.addElementAfter(e,i);else this.addElementBefore(e,i);else if(e.isInblock()&&i)if(i.isOnlyHasBreak())this.addElementTo(e,i,0);else if(0!=this.range.anchor.offset||n&&i.isContains(n))if(this.range.anchor.offset!=o||s&&i.isContains(s)){const t=i.clone();this.addElementAfter(t,i),this.range.focus.moveToEnd(i),this.delete();const n=E.flatElements(i.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementTo(e,t),this.mergeBlockElement(t,i)}else this.addElementTo(e,i,i.children.length);else this.addElementTo(e,i,0);else if(e.isInblock())if(r.isOnlyHasBreak())this.addElementTo(e,r,0);else if(0!=this.range.anchor.offset||n&&r.isContains(n))if(this.range.anchor.offset!=o||s&&r.isContains(s)){const t=r.clone();this.addElementAfter(t,r),this.range.focus.moveToEnd(r),this.delete();const n=E.flatElements(r.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementTo(e,t),this.mergeBlockElement(t,r)}else this.addElementTo(e,r,r.children.length);else this.addElementTo(e,r,0);else if(e.isBlock())if(r.isOnlyHasBreak()&&t)this.addElementBefore(e,r),r.toEmpty();else if(0!=this.range.anchor.offset||n&&r.isContains(n))if(this.range.anchor.offset!=o||s&&r.isContains(s)){const t=r.clone();this.addElementAfter(t,r),this.range.focus.moveToEnd(r),this.delete();const n=E.flatElements(r.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=E.flatElements(t.children);this.range.focus.element=s[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete(),this.addElementBefore(e,t)}else this.addElementAfter(e,r);else this.addElementBefore(e,r);else if(this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent,n=this.range.anchor.element.clone();this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset),n.textContent=t.substring(this.range.anchor.offset),this.addElementAfter(n,this.range.anchor.element),this.addElementBefore(e,n)}else 0==this.range.anchor.offset?this.addElementBefore(e,this.range.anchor.element):this.addElementAfter(e,this.range.anchor.element);this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}else this.delete(),this.insertElement(e,t)}formatElementStack(){const e=(t,n)=>{if(t.hasChildren()){let s=0;for(;s<t.children.length;){let r=t.children[s];e(r,n);s=t.children.findIndex((e=>r.isEqual(e)))+1}}n.apply(this,[t])},t=e=>{e.isEmpty()||e.hasChildren()&&(e.children.forEach((e=>{e.isEmpty()||t(e)})),e.children=e.children.filter((e=>!e.isEmpty())))};let n=this.renderRules.filter((e=>"function"==typeof e));if(n=[...n,...this.__formatUnchangeableRules],n.forEach((t=>{let n=0;for(;n<this.stack.length;){const s=this.stack[n];e(s,t);n=this.stack.findIndex((e=>s.isEqual(e)))+1}})),this.stack.forEach((e=>{t(e)})),this.stack=this.stack.filter((e=>!e.isEmpty())),0==this.stack.length){const e=new E("block",E.BLOCK_NODE,null,null,null),t=new E("closed","br",null,null,null);this.addElementTo(t,e),this.stack=[e]}}domRender(e=!1){this.__oldStack?(this.__removeDeletedElementDom(),this.__updateElementDom(),this.__filterIllegalDom()):(this.$el.innerHTML="",this.stack.forEach((e=>{e.__renderElement(),this.$el.appendChild(e._elm)}))),this.__oldValue=this.value,this.__oldStack=this.__cloneStack(),this.value=this.$el.innerHTML,this.__oldValue!=this.value&&(this.emit("change",this.value,this.__oldValue),e||this.history.push(this.stack,this.range),this.emit("domRender"))}rangeRender(){if(this.disabled)return;const e=e=>{let t=null,n=null;if(e.element.isText())t=e.element._elm.childNodes[0],n=e.offset;else{t=e.element.parent._elm;const s=e.element.parent.children.findIndex((t=>e.element.isEqual(t)));n=e.offset+s}return{node:t,offset:n}},t=e(this.range.anchor),n=e(this.range.focus),s=window.getSelection();s.removeAllRanges();const r=document.createRange();r.setStart(t.node,t.offset),r.setEnd(n.node,n.offset),s.addRange(r)}parseHtml(e){if(!e)throw new Error("You need to give an html content to convert");const t=document.createElement("div");t.innerHTML=e;let n=[];return Array.from(t.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);n.push(t)}})),n}parseNode(e){if(!(e instanceof Node))throw new Error("The argument must be an node");if(1!=e.nodeType&&3!=e.nodeType)throw new Error("The argument must be an element node or text node");if(3==e.nodeType)return new E("text",null,null,null,e.textContent);const t=p.getAttributes(e),n=p.getStyles(e),s=e.nodeName.toLocaleLowerCase(),r=x.block.find((e=>e.parsedom==s)),i=x.inblock.find((e=>e.parsedom==s)),o=x.inline.find((e=>e.parsedom==s)),a=x.closed.find((e=>e.parsedom==s));let l=null,h={type:"inblock",parsedom:s,marks:t,styles:n,behavior:"default"};return r?(h.type="block",r.parse&&(h.parsedom=E.BLOCK_NODE)):i?(h.type="inblock",i.block&&(h.behavior="block")):o?(h.type="inline",o.parse&&(h.parsedom=E.TEXT_NODE,g.common.isObject(o.parse)&&Object.assign(h.styles,p.clone(o.parse)))):a?h.type="closed":(h.type="inline",h.parsedom="span"),l=new E(h.type,h.parsedom,h.marks,h.styles,null),l.behavior=h.behavior,(r||i||o)&&Array.from(e.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);t.parent=l,l.hasChildren()?l.children.push(t):l.children=[t]}})),l}mergeBlockElement(e,t){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(!e.isBlock()&&!e.isInblock()||!t.isBlock()&&!t.isInblock())throw new Error('Elements that are not "block" or "inblock" cannot be merged');t.children.push(...e.children),t.children.forEach((e=>{e.parent=t})),e.children=null}getElementByKey(e){if(!e)throw new Error("You need to specify a key to do the query");return E.flatElements(this.stack).find((t=>t.key==e))}getPreviousElement(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isBlock()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t<=0?null:this.stack[t-1].isEmpty()?this.getPreviousElement(this.stack[t-1]):this.stack[t-1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t<=0?null:e.parent.children[t-1].isEmpty()?this.getPreviousElement(e.parent.children[t-1]):e.parent.children[t-1]}}getNextElement(e){if(!E.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isBlock()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t>=this.stack.length-1?null:this.stack[t+1].isEmpty()?this.getNextElement(this.stack[t+1]):this.stack[t+1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t>=e.parent.children.length-1?null:e.parent.children[t+1].isEmpty()?this.getNextElement(e.parent.children[t+1]):e.parent.children[t+1]}}getPreviousElementOfPoint(e){if(!b.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=E.flatElements(this.stack),n=e=>{const s=t.findIndex((t=>e.isEqual(t)));if(s<=0)return null;let r=t[s-1];return!r.isText()&&!r.isClosed()||r.isEmpty()?n(r):r};return n(e.element)}getNextElementOfPoint(e){if(!b.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=E.flatElements(this.stack),n=e=>{const s=t.findIndex((t=>e.isEqual(t)));if(s==t.length-1)return null;let r=t[s+1];return!r.isText()&&!r.isClosed()||r.isEmpty()?n(r):r};return n(e.element)}getElementsByRange(e=!1,t=!1){if(this.range.anchor.isEqual(this.range.focus))return[];let n=[];if(this.range.anchor.element.isEqual(this.range.focus.element)){if(e)if(this.range.anchor.element.isText())if(0==this.range.anchor.offset&&this.range.focus.offset==this.range.anchor.element.textContent.length)n=[this.range.anchor.element];else if(0==this.range.anchor.offset){let e=this.range.anchor.element.textContent,t=this.range.anchor.element.clone();this.range.anchor.element.textContent=e.substring(0,this.range.focus.offset),t.textContent=e.substring(this.range.focus.offset),this.addElementAfter(t,this.range.anchor.element),n=[this.range.anchor.element]}else if(this.range.focus.offset==this.range.anchor.element.textContent.length){let e=this.range.anchor.element.clone(),t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset),e.textContent=t.substring(this.range.anchor.offset),this.addElementAfter(e,this.range.anchor.element),n=[e],this.range.anchor.moveToStart(e),this.range.focus.moveToEnd(e)}else{let e=this.range.anchor.element.clone(),t=this.range.anchor.element.clone(),s=this.range.anchor.element.textContent;this.range.anchor.element.textContent=s.substring(0,this.range.anchor.offset),e.textContent=s.substring(this.range.anchor.offset,this.range.focus.offset),t.textContent=s.substring(this.range.focus.offset),this.addElementAfter(e,this.range.anchor.element),this.addElementAfter(t,e),this.range.anchor.moveToStart(e),this.range.focus.moveToEnd(e),n=[e]}else n=[this.range.anchor.element]}else{const t=E.flatElements(this.stack),s=t.findIndex((e=>this.range.anchor.element.isEqual(e))),r=t.findIndex((e=>this.range.focus.element.isEqual(e)));for(let e=s+1;e<r;e++)t[e].isContains(this.range.anchor.element)||t[e].isContains(this.range.focus.element)||n.push(t[e]);if(e){if(this.range.anchor.element.isText()){if(0==this.range.anchor.offset)n.unshift(this.range.anchor.element);else if(this.range.anchor.offset<this.range.anchor.element.textContent.length){let e=this.range.anchor.element.clone(),t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset),e.textContent=t.substring(this.range.anchor.offset),this.addElementAfter(e,this.range.anchor.element),n.unshift(e),this.range.anchor.moveToStart(e)}}else 0==this.range.anchor.offset&&n.unshift(this.range.anchor.element);if(this.range.focus.element.isText()){if(this.range.focus.offset==this.range.focus.element.textContent.length)n.push(this.range.focus.element);else if(this.range.focus.offset>0){let e=this.range.focus.element.clone(),t=this.range.focus.element.textContent;this.range.focus.element.textContent=t.substring(0,this.range.focus.offset),e.textContent=t.substring(this.range.focus.offset),this.addElementAfter(e,this.range.focus.element),n.push(this.range.focus.element)}}else 1==this.range.focus.offset&&n.push(this.range.focus.element)}}if(t)return n;let s=[];return n.forEach((e=>{if(e.isBlock())s.push(e);else{n.some((t=>t.isEqual(e.parent)))||s.push(e)}})),s}addElementTo(e,t,n=0){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if("number"!=typeof n||isNaN(n)||n<0)throw new Error("The third argument must be an integer not less than 0");t.hasChildren()?n>=t.children.length?t.children.push(e):t.children.splice(n,0,e):t.children=[e],e.parent=t}addElementBefore(e,t){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isBlock()){const n=this.stack.findIndex((e=>t.isEqual(e)));this.stack.splice(n,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n)}}addElementAfter(e,t){if(!E.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!E.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isBlock()){const n=this.stack.findIndex((e=>t.isEqual(e)));n>=this.stack.length-1?this.stack.push(e):this.stack.splice(n+1,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n+1)}}collapseToStart(e){if(!this.disabled)if(E.isElement(e))this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e);else{const e=E.flatElements(this.stack);this.range.anchor.moveToStart(e[0]),this.range.focus.moveToStart(e[0])}}collapseToEnd(e){if(!this.disabled)if(E.isElement(e))this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e);else{const e=E.flatElements(this.stack),t=e.length;this.range.anchor.moveToEnd(e[t-1]),this.range.focus.moveToEnd(e[t-1])}}setDisabled(){this.disabled=!0,this.$el.removeAttribute("contenteditable")}setEnabled(){this.disabled=!1,this.$el.setAttribute("contenteditable",!0)}setTextStyle(e){if(!g.common.isObject(e))throw new Error("The argument must be an object");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.isSpaceText())this.range.anchor.element.hasStyles()?Object.assign(this.range.anchor.element.styles,p.clone(e)):this.range.anchor.element.styles=p.clone(e);else if(this.range.anchor.element.isText()){const t=E.getSpaceElement();t.styles=p.clone(this.range.anchor.element.styles),t.marks=p.clone(this.range.anchor.element.marks),t.hasStyles()?Object.assign(t.styles,p.clone(e)):t.styles=p.clone(e),this.insertElement(t)}else{const t=E.getSpaceElement();t.styles=p.clone(e),this.insertElement(t)}else{this.getElementsByRange(!0,!0).forEach((t=>{t.isText()&&(t.hasStyles()?Object.assign(t.styles,p.clone(e)):t.styles=p.clone(e))}))}}removeTextStyle(e){const t=t=>{if(Array.isArray(e)){if(t.hasStyles()){let n={};for(let s in t.styles)e.includes(s)||(n[s]=t.styles[s]);t.styles=n}}else t.styles=null};if(this.range.anchor.isEqual(this.range.focus)){if(this.range.anchor.element.isSpaceText())t(this.range.anchor.element);else if(this.range.anchor.element.isText()){const e=E.getSpaceElement();e.styles=p.clone(this.range.anchor.element.styles),e.marks=p.clone(this.range.anchor.element.marks),t(e),this.insertElement(e)}}else{this.getElementsByRange(!0,!0).forEach((e=>{e.isText()&&t(e)}))}}queryTextStyle(e,t){if(!e)throw new Error("The first argument cannot be null");if(this.range.anchor.isEqual(this.range.focus))return!(!this.range.anchor.element.isText()||!this.range.anchor.element.hasStyles())&&(null==t||null==t?this.range.anchor.element.styles.hasOwnProperty(e):this.range.anchor.element.styles[e]==t);const n=this.getElementsByRange(!0,!0).filter((e=>e.isText()));if(0==n.length)return!1;return n.every((n=>!!n.hasStyles()&&(null==t||null==t?n.styles.hasOwnProperty(e):n.styles[e]==t)))}setTextMark(e){if(!g.common.isObject(e))throw new Error("The argument must be an object");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.isSpaceText())this.range.anchor.element.hasMarks()?Object.assign(this.range.anchor.element.marks,p.clone(e)):this.range.anchor.element.marks=p.clone(e);else if(this.range.anchor.element.isText()){const t=E.getSpaceElement();t.styles=p.clone(this.range.anchor.element.styles),t.marks=p.clone(this.range.anchor.element.marks),t.hasMarks()?Object.assign(t.marks,p.clone(e)):t.marks=p.clone(e),this.insertElement(t)}else{const t=E.getSpaceElement();t.marks=p.clone(e),this.insertElement(t)}else{this.getElementsByRange(!0,!0).forEach((t=>{t.isText()&&(t.hasMarks()?Object.assign(t.marks,p.clone(e)):t.marks=p.clone(e))}))}}removeTextMark(e){const t=t=>{if(Array.isArray(e)){if(t.hasMarks()){let n={};for(let s in t.marks)e.includes(s)||(n[s]=t.marks[s]);t.marks=n}}else t.marks=null};if(this.range.anchor.isEqual(this.range.focus)){if(this.range.anchor.element.isSpaceText())t(this.range.anchor.element);else if(this.range.anchor.element.isText()){const e=E.getSpaceElement();e.styles=p.clone(this.range.anchor.element.styles),e.marks=p.clone(this.range.anchor.element.marks),t(e),this.insertElement(e)}}else{this.getElementsByRange(!0,!0).forEach((e=>{e.isText()&&t(e)}))}}queryTextMark(e,t){if(!e)throw new Error("The first argument cannot be null");if(this.range.anchor.isEqual(this.range.focus))return!(!this.range.anchor.element.isText()||!this.range.anchor.element.hasMarks())&&(null==t||null==t?this.range.anchor.element.marks.hasOwnProperty(e):this.range.anchor.element.marks[e]==t);const n=this.getElementsByRange(!0,!0).filter((e=>e.isText()));if(0==n.length)return!1;return n.every((n=>!!n.hasMarks()&&(null==t||null==t?n.marks.hasOwnProperty(e):n.marks[e]==t)))}setIndent(){const e=e=>{if(e.hasStyles())if(e.styles.hasOwnProperty("text-indent")){let t=e.styles["text-indent"];t=t.endsWith("em")?parseFloat(t):0,e.styles["text-indent"]=`${t+2}em`}else e.styles["text-indent"]="2em";else e.styles={"text-indent":"2em"}};if(this.range.anchor.isEqual(this.range.focus)){const t=this.range.anchor.element.getBlock(),n=this.range.anchor.element.getInblock();n&&"block"==n.behavior?e(n):e(t)}else{this.getElementsByRange(!0,!1).forEach((t=>{const n=t.getBlock(),s=t.getInblock();s&&"block"==s.behavior?e(s):e(n)}))}this.formatElementStack(),this.domRender(),this.rangeRender()}setOutdent(){const e=e=>{if(e.hasStyles()&&e.styles.hasOwnProperty("text-indent")){let t=e.styles["text-indent"];t=t.endsWith("em")?parseFloat(t):0,e.styles["text-indent"]=(t-2>=0?t-2:0)+"em"}};if(this.range.anchor.isEqual(this.range.focus)){const t=this.range.anchor.element.getBlock(),n=this.range.anchor.element.getInblock();n&&"block"==n.behavior?e(n):e(t)}else{this.getElementsByRange(!0,!1).forEach((t=>{const n=t.getBlock(),s=t.getInblock();s&&"block"==s.behavior?e(s):e(n)}))}this.formatElementStack(),this.domRender(),this.rangeRender()}emit(e,...t){return!!Array.isArray(this.__events[e])&&(this.__events[e].forEach((e=>{e.apply(this,[...t])})),!0)}on(e,t){this.__events[e]||(this.__events[e]=[]),this.__events[e].push(t)}destroy(){this.setDisabled(),g.event.off(document,`selectionchange.alex_editor_${this.__guid}`),g.event.off(this.$el,"beforeinput.alex_editor compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor keydown.alex_editor cut.alex_editor paste.alex_editor copy.alex_editor dragstart.alex_editor drop.alex_editor focus.alex_editor blur.alex_editor")}}e.AlexEditor=_,e.AlexElement=E,e.default=_,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
