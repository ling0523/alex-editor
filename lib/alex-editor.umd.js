!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["alex-editor"]={})}(this,(function(e){"use strict";var t=Object.defineProperty,n=(e,n,r)=>(((e,n,r)=>{n in e?t(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r})(e,"symbol"!=typeof n?n+"":n,r),r);function r(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var s={exports:{}};window,s.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){e.exports={formatNumber:function(e){return this.isNumber(e)?e.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):e},isNumber:function(e){return"number"==typeof e&&!isNaN(e)},add:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){var n,r=0,s=0;try{r=e.toString().split(".")[1].length}catch(i){}try{s=t.toString().split(".")[1].length}catch(i){}return(e*(n=Math.pow(10,Math.max(r,s)))+t*n)/n}))},subtract:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){var n,r=0,s=0;try{r=e.toString().split(".")[1].length}catch(i){}try{s=t.toString().split(".")[1].length}catch(i){}return(e*(n=Math.pow(10,Math.max(r,s)))-t*n)/n}))},mutiply:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){var n=0,r=e.toString(),s=t.toString();try{n+=r.split(".")[1].length}catch(i){}try{n+=s.split(".")[1].length}catch(i){}return Number(r.replace(".",""))*Number(s.replace(".",""))/Math.pow(10,n)}))},divide:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){var n=0,r=0,s=e.toString(),i=t.toString();try{n=s.split(".")[1].length}catch(o){}try{r=i.split(".")[1].length}catch(o){}return(s=Number(s.replace(".","")))/(i=Number(i.replace(".","")))*Math.pow(10,r-n)}))}}},function(e,t,n){function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var s=n(4),i=n(0);e.exports={isWindow:function(e){return!!(e&&e.constructor&&e.constructor.name)&&"Window"==e.constructor.name},getElementPoint:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(this.isElement(t)||(t=document.body),!this.isContains(t,e))throw new Error("The second argument and the first argument have no hierarchical relationship");for(var n=e,r=0,s=0;this.isElement(e)&&this.isContains(t,e)&&t!==e;)r+=e.offsetTop,s+=e.offsetLeft,e=e.offsetParent;return{top:r,left:s,right:t.offsetWidth-s-n.offsetWidth,bottom:t.offsetHeight-r-n.offsetHeight}},isContains:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t,!0))throw new TypeError("The second argument must be an element");return e===t||(e.contains?e.contains(t):e.compareDocumentPosition?!!(16&e.compareDocumentPosition(t)):void 0)},isParentNode:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!this.isElement(t,!0))throw new TypeError("The second argument must be an element");return e!==t&&t.parentNode===e},children:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");var n=e.querySelectorAll(t||"*");return[].concat(r(n)).filter((function(t){return t.parentNode===e}))},siblings:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(t&&"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!e.parentNode)return[];var n=e.parentNode.querySelectorAll(t||"*");return[].concat(r(n)).filter((function(t){return t.parentNode===e.parentNode&&t!=e}))},rem2px:function(e){if(!i.isNumber(e))throw new TypeError("The argument must be a number");var t=this.getCssStyle(document.documentElement,"font-size");return i.mutiply(e,parseFloat(t))},px2rem:function(e){if(!i.isNumber(e))throw new TypeError("The argument must be a number");var t=this.getCssStyle(document.documentElement,"font-size");return i.divide(e,parseFloat(t))},width:function(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);var t=e.clientWidth,n=parseFloat(this.getCssStyle(e,"padding-left")),r=parseFloat(this.getCssStyle(e,"padding-right"));return i.subtract(t,n,r)},height:function(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);var t=e.clientHeight,n=parseFloat(this.getCssStyle(e,"padding-top")),r=parseFloat(this.getCssStyle(e,"padding-bottom"));return i.subtract(t,n,r)},removeClass:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");var n=e.classList;s.trim(t).split(/\s+/).forEach((function(e,t){n.remove(e)}))},addClass:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");var n=e.classList;s.trim(t).split(/\s+/).forEach((function(e,t){n.add(e)}))},hasClass:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");var n=e.classList;return s.trim(t).split(/\s+/).every((function(e,t){return n.contains(e)}))},scrollTopBottomTrigger:function(e,t){var n=this;"string"==typeof e&&e&&(e=document.body.querySelector(e));var r=window;this.isElement(e)&&e!=document.body&&e!=document.documentElement&&(r=e),"function"==typeof e&&(t=e);var s=!0;r.addEventListener("scroll",(function(e){if(n.getScrollTop(r)<=0){if(!s)return;"function"==typeof t&&(s=!1,t({state:"top",target:r}))}else{var o={state:"bottom",target:r},a=0;if(a=r==window?window.innerHeight:r.clientHeight,i.add(n.getScrollTop(r),a)+1>=n.getScrollHeight(r)&&a!=n.getScrollHeight(r)){if(!s)return;"function"==typeof t&&(s=!1,t(o))}else s=!0}}))},getScrollWidth:function(e){return"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollWidth:0==document.documentElement.scrollWidth||0==document.body.scrollWidth?document.documentElement.scrollWidth||document.body.scrollWidth:document.documentElement.scrollWidth>document.body.scrollWidth?document.documentElement.scrollWidth:document.body.scrollWidth},getScrollHeight:function(e){return"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)&&e!=document.documentElement&&e!=document.body?e.scrollHeight:0==document.documentElement.scrollHeight||0==document.body.scrollHeight?document.documentElement.scrollHeight||document.body.scrollHeight:document.documentElement.scrollHeight>document.body.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight},setScrollTop:function(e){var t=this,n=!1,r=e.el;"string"==typeof r&&r&&(r=document.body.querySelector(r));var s=e.number||0,o=e.time||0;return this.isElement(r)&&r!=document.body&&r!=document.documentElement&&r!=window||(n=!0),new Promise((function(e,a){if(o<=0)n?document.documentElement.scrollTop=document.body.scrollTop=s:r.scrollTop=s,e();else var l=i.divide(o,10),h=t.getScrollTop(r),c=i.divide(i.subtract(s,h),l),u=setInterval((function(){l>0?(l--,n?document.documentElement.scrollTop=document.body.scrollTop=h=i.add(h,c):r.scrollTop=h=i.add(h,c)):(clearInterval(u),e())}),10)}))},getScrollTop:function(e){return"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollTop:0==document.documentElement.scrollTop||0==document.body.scrollTop?document.documentElement.scrollTop||document.body.scrollTop:document.documentElement.scrollTop>document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop},getScrollLeft:function(e){return"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)&&e!=document.body&&e!=document.documentElement&&e!=window?e.scrollLeft:0==document.documentElement.scrollLeft||0==document.body.scrollLeft?document.documentElement.scrollLeft||document.body.scrollLeft:document.documentElement.scrollLeft>document.body.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft},setScrollLeft:function(e){var t=this,n=!1,r=e.el;"string"==typeof r&&r&&(r=document.body.querySelector(r));var s=e.number||0,o=e.time||0;return this.isElement(r)&&r!=document.body&&r!=document.documentElement&&r!=window||(n=!0),new Promise((function(e,a){if(o<=0)n?document.documentElement.scrollLeft=document.body.scrollLeft=s:r.scrollLeft=s,e();else var l=i.divide(o,10),h=t.getScrollLeft(r),c=i.divide(i.subtract(s,h),l),u=setInterval((function(){l>0?(l--,n?document.documentElement.scrollLeft=document.body.scrollLeft=h=i.add(h,c):r.scrollLeft=h=i.add(h,c)):(clearInterval(u),e())}),10)}))},getCssStyle:function(e,t){if(!this.isElement(e))throw new TypeError("The first argument must be an element");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");return document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e)[t]:e.currentStyle[t]},getCssSelector:function(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a selector string");if(/^#{1}/.test(e))return{type:"id",value:e.substr(1)};if(/^\./.test(e))return{type:"class",value:e.substr(1)};if(/^\[(.+)\]$/.test(e)){var t="",n=s.trim(e,!0).substring(1,s.trim(e,!0).length-1).split("=");return 1==n.length&&(t=n[0]),2==n.length&&(t={attributeName:n[0],attributeValue:n[1].replace(/\'/g,"").replace(/\"/g,"")}),{type:"attribute",value:t}}return{type:"tag",value:e}},getElementBounding:function(e){"string"==typeof e&&e&&(e=document.body.querySelector(e)),this.isElement(e)||(e=document.body);var t=e.getBoundingClientRect();return{top:t.top,bottom:i.subtract(document.documentElement.clientHeight||window.innerHeight,t.bottom),left:t.left,right:i.subtract(document.documentElement.clientWidth||window.innerWidth,t.right)}},isElement:function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?e&&(1===e.nodeType||3===e.nodeType)&&e instanceof Node:e&&1===e.nodeType&&e instanceof Node},string2dom:function(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be an HTML string");var t=document.createElement("div");return t.innerHTML=e,1==t.children.length?t.children[0]:t.children}}},function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(1);e.exports={matchingText:function(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");var n=null;if("Chinese"==t&&(n=/^[\u4e00-\u9fa5]+$/),"chinese"==t&&(n=/[\u4e00-\u9fa5]/),"email"==t&&(n=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/),"userName"==t&&(n=/^[a-zA-Z0-9_]{4,16}$/),"int+"==t&&(n=/^\d+$/),"int-"==t&&(n=/^-\d+$/),"int"==t&&(n=/^-?\d+$/),"pos"==t&&(n=/^\d*\.?\d+$/),"neg"==t&&(n=/^-\d*\.?\d+$/),"number"==t&&(n=/^-?\d*\.?\d+$/),"phone"==t&&(n=/^1[0-9]\d{9}$/),"idCard"==t&&(n=/^[1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/),"url"==t&&(n=/^((https?|ftp|file):\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/),"IPv4"==t&&(n=/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/),"hex"==t&&(n=/^#?([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/),"date"==t)return/^((\d{4})(-)(\d{2})(-)(\d{2}))$/.test(e)||/^(\d{4})(\/)(\d{2})(\/)(\d{2})$/.test(e)||/^(\d{4})(\.)(\d{2})(\.)(\d{2})$/.test(e)||/^(\d{4})(年)(\d{2})(月)(\d{2})(日)$/.test(e);if("time"==t&&(n=/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d$/),"QQ"==t&&(n=/^[1-9][0-9]{4,10}$/),"weixin"==t&&(n=/^[a-zA-Z]([-_a-zA-Z0-9]{5,19})+$/),"plate"==t&&(n=/^[京津沪渝冀豫云辽黑湘皖鲁新苏浙赣鄂桂甘晋蒙陕吉闽贵粤青藏川宁琼使领A-Z]{1}[A-Z]{1}[A-Z0-9]{4}[A-Z0-9挂学警港澳]{1}$/),!n)throw new Error("The second parameter is out of scope");return n.test(e)},getUrlParams:function(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1);if(!n){var r=window.location.hash.split("?");2==r.length&&(n=r[1])}var s=n.match(t);return s?decodeURIComponent(s[2]):null},isEmptyObject:function(e){return!!this.isObject(e)&&0==Object.keys(e).length},equal:function(e,t){if((void 0===e?"undefined":r(e))!==(void 0===t?"undefined":r(t)))return!1;if(this.isObject(e)&&this.isObject(t)){e=Object.assign({},e),t=Object.assign({},t);var n=Object.getOwnPropertyNames(e),s=Object.getOwnPropertyNames(t);if(n.length!=s.length)return!1;for(var i=n.length,o=0;o<i;o++){var a=n[o],l=e[a],h=t[a];if(this.isObject(l))return!!this.equal(l,h);if(l!==h)return!1}return!0}return e===t},isObject:function(e){return!("object"!==(void 0===e?"undefined":r(e))||!e)},copyText:function(e){if(!e||"string"!=typeof e)throw new TypeError("No text to copy is defined");var t=s.string2dom('<input type="text" />');document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}}},function(e,t,n){var r=n(1),s="_dap-datas";e.exports={remove:function(e,t){if(!(e instanceof Document||r.isElement(e,!0)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");var n=e[s]||{};null==t||""===t?e[s]={}:(delete n[t],e[s]=n)},has:function(e,t){if(!(e instanceof Document||r.isElement(e,!0)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");return(e[s]||{}).hasOwnProperty(t)},get:function(e,t){if(!(e instanceof Document||r.isElement(e,!0)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");var n=e[s]||{};return null==t||""===t?n:n[t]},set:function(e,t,n){if(!(e instanceof Document||r.isElement(e,!0)||r.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(null==t||""===t)throw new TypeError("The second parameter must be a unique key");var i=e[s]||{};i[t]=n,e[s]=i}}},function(e,t,n){var r=n(0);e.exports={insert:function(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if("string"!=typeof t)throw new TypeError("The second argument must be a string");if(!r.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,n)+t+e.substring(n,e.length)},delete:function(e,t,n){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!r.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!r.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");return e.substring(0,t)+e.substring(t+n,e.length)},replace:function(e,t,n,s){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!r.isNumber(t))throw new TypeError("The second argument must be a number");if(t<0)throw new Error("The second argument cannot be less than 0");if(!r.isNumber(n))throw new TypeError("The third argument must be a number");if(n<0)throw new Error("The third argument cannot be less than 0");if("string"!=typeof s)throw new TypeError("The fourth argument must be a string");return e.substring(0,t)+s+e.substring(n,e.length)},trim:function(e,t){if("string"!=typeof e)throw new TypeError("The first argument must be a string");var n=e.replace(/(^\s+)|(\s+$)/g,"");return t&&(n=n.replace(/\s/g,"")),n}}},function(e,t,n){var r=n(0),s=n(3),i=n(1),o=n(6),a=n(2),l=n(7),h=n(8),c=n(9),u=n(4),d=n(10),m=n(11);e.exports={number:r,data:s,element:i,event:o,common:a,date:l,color:h,file:c,string:u,platform:d,speech:m}},function(e,t,n){var r=n(3),s=n(1),i=n(2),o=function(e){var t=e.split(/[\s]+/g),n=[];return t.forEach((function(e){var t=e.split("."),r={eventName:t[0]};t.length>1&&(r.guid=t[1]),n.push(r)})),n},a=function(e,t,n){for(var s=r.get(e,"dap-defined-events")||{},i=Object.keys(s),o=i.length,a=0;a<o;a++){var l=i[a];s[l].type==t&&(n?l==t+"_"+n&&(e.removeEventListener(s[l].type,s[l].fn,s[l].options),s[l]=void 0):(e.removeEventListener(s[l].type,s[l].fn,s[l].options),s[l]=void 0))}var h,c;h=s,c={},Object.keys(h).forEach((function(e){h[e]&&(c[e]=h[e])})),s=c,r.set(e,"dap-defined-events",s)};e.exports={on:function(e,t,n,a){if(!(e instanceof Document||s.isElement(e)||s.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");if(!n||"function"!=typeof n)throw new TypeError("The third argument must be a function");i.isObject(a)||(a={}),o(t).forEach((function(t){var s,i,o,l,h,c;s=e,i=t.eventName,o=t.guid,l=n.bind(e),h=a,c=r.get(s,"dap-defined-events")||{},o||(o=r.get(s,"dap-event-guid")||0,r.set(s,"dap-event-guid",o+1)),c[o=i+"_"+o]&&c[o].type==i&&s.removeEventListener(i,c[o].fn,c[o].options),s.addEventListener(i,l,h),c[o]={type:i,fn:l,options:h},r.set(s,"dap-defined-events",c)}))},off:function(e,t){if(!(e instanceof Document||s.isElement(e)||s.isWindow(e)))throw new TypeError("The first argument must be an element node or window or document");var n=r.get(e,"dap-defined-events");if(n){if(!t){for(var i=Object.keys(n),l=i.length,h=0;h<l;h++){var c=i[h];e.removeEventListener(n[c].type,n[c].fn,n[c].options)}return r.remove(e,"dap-defined-events"),void r.remove(e,"dap-event-guid")}o(t).forEach((function(t){a(e,t.eventName,t.guid)}))}}}},function(e,t,n){var r=n(0);e.exports={getPrevMonths:function(e,t){e&&e instanceof Date||(e=new Date),r.isNumber(t)||(t=1);for(var n=[e],s=0;s<t-1;s++){var i=e.getFullYear(),o=e.getMonth();0==o&&(o=12,i--);var a=new Date;a.setMonth(o-1),a.setFullYear(i),n.push(a),e=a}return n},getNextMonths:function(e,t){e&&e instanceof Date||(e=new Date),r.isNumber(t)||(t=1);for(var n=[e],s=0;s<t-1;s++){var i=e.getFullYear(),o=e.getMonth();11==o&&(o=-1,i++);var a=new Date;a.setMonth(o+1),a.setFullYear(i),n.push(a),e=a}return n},getDateAfter:function(e,t){return e&&e instanceof Date||(e=new Date),r.isNumber(t)||(t=1),new Date(e.getTime()+24*t*60*60*1e3)},getDateBefore:function(e,t){return e&&e instanceof Date||(e=new Date),r.isNumber(t)||(t=1),new Date(e.getTime()-24*t*60*60*1e3)},getDays:function(e,t){if(!r.isNumber(e))throw new TypeError("The first parameter must be a number representing the year");if(!r.isNumber(t))throw new TypeError("The second argument must be a number representing the month");return e=parseInt(e),t=parseInt(t),new Date(e,t,0).getDate()}}},function(e,t,n){var r=n(2);e.exports={rgb2hsv:function(e){if(!Array.isArray(e)||3!=e.length)throw new TypeError("Invalid argument");var t=0,n=0,r=0,s=e[0]>=255?255:e[0],i=e[1]>=255?255:e[1],o=e[2]>=255?255:e[2];s=s<=0?0:s,i=i<=0?0:i,o=o<=0?0:o;var a=Math.max(s,i,o),l=Math.min(s,i,o);return r=a/255,n=0===a?0:1-l/a,a===l?t=0:a===s&&i>=o?t=(i-o)/(a-l)*60+0:a===s&&i<o?t=(i-o)/(a-l)*60+360:a===i?t=(o-s)/(a-l)*60+120:a===o&&(t=(s-i)/(a-l)*60+240),[t=parseInt(t),n=parseInt(100*n),r=parseInt(100*r)]},hsv2rgb:function(e){if(!Array.isArray(e)||3!=e.length)throw new TypeError("Invalid argument");var t=e[0]>=360||e[0]<=0?0:e[0],n=e[1]>=100?100:e[1];n=n<=0?0:n;var r=e[2]>=100?100:e[2];r=r<=0?0:r,n/=100,r/=100;var s=0,i=0,o=0,a=parseInt(t/60%6),l=t/60-a,h=r*(1-n),c=r*(1-l*n),u=r*(1-(1-l)*n);switch(a){case 0:s=r,i=u,o=h;break;case 1:s=c,i=r,o=h;break;case 2:s=h,i=r,o=u;break;case 3:s=h,i=c,o=r;break;case 4:s=u,i=h,o=r;break;case 5:s=r,i=h,o=c}return[s=parseInt(255*s),i=parseInt(255*i),o=parseInt(255*o)]},rgb2hex:function(e){if(!Array.isArray(e)||3!=e.length)throw new TypeError("Invalid argument");return"#"+((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)},hex2rgb:function(e){if(!e||"string"!=typeof e)throw new TypeError("The argument must be a string");var t=e.toLowerCase();if(!r.matchingText(t,"hex"))throw new TypeError("The argument must be a hexadecimal color value");if(4===t.length){for(var n="#",s=1;s<4;s+=1)n+=t.slice(s,s+1).concat(t.slice(s,s+1));t=n}for(var i=[],o=1;o<7;o+=2)i.push(parseInt("0x"+t.slice(o,o+2)));return i}}},function(e,t,n){e.exports={getImageUrl:function(e){if(!(e&&e instanceof File))throw new TypeError("The argument must be a File object");return window.URL.createObjectURL(e)},dataFileToBase64:function(e){return new Promise((function(t,n){e&&e instanceof File||n(new TypeError("The argument must be a File object"));var r=new FileReader;r.readAsDataURL(e),r.onloadend=function(){var e=r.result;t(e)}}))},dataBase64toFile:function(e,t){if(!e||"string"!=typeof e)throw new TypeError("The first argument must be a string");if(!t||"string"!=typeof t)throw new TypeError("The second argument must be a string");for(var n=e.split(","),r=n[0].match(/:(.*?);/)[1],s=atob(n[1]),i=s.length,o=new Uint8Array(i);i--;)o[i]=s.charCodeAt(i);return new File([o],t,{type:r})}}},function(e,t,n){e.exports={language:function(){return window.navigator.browserLanguage||window.navigator.language},device:function(){var e=window.navigator.userAgent;return{PC:!e.match(/AppleWebKit.*Mobile.*/),Mobile:!!e.match(/AppleWebKit.*Mobile.*/),iPhone:e.includes("iPhone"),Phone:e.includes("Android")&&/(?:Mobile)/.test(e)||e.includes("iPhone")||/(?:Windows Phone)/.test(e),iPad:e.includes("iPad"),Tablet:e.includes("iPad")||e.includes("Android")&&!/(?:Mobile)/.test(e)||e.includes("Firefox")&&/(?:Tablet)/.test(e),WindowsPhone:/(?:Windows Phone)/.test(e)}},browser:function(){var e=window.navigator.userAgent;return{Edge:!!e.match(/Edg\/([\d.]+)/),weixin:e.includes("MicroMessenger"),QQ:e.includes("QQ"),QQBrowser:e.includes("MQQBrowser"),UC:e.includes("UCBrowser"),Chrome:e.includes("Chrome"),Firefox:e.includes("Firefox"),sougou:e.toLocaleLowerCase().includes("se 2.x")||e.toLocaleLowerCase().includes("metasr")||e.toLocaleLowerCase().includes("sogou"),Safari:e.includes("Safari")&&!e.includes("Chrome")}},browserKernel:function(){var e=window.navigator.userAgent;return e.includes("Presto")?"opera":e.includes("AppleWebKit")?"webkit":e.includes("Gecko")&&!e.includes("KHTML")?"gecko":""},os:function(){var e,t=window.navigator.userAgent;return{Windows:t.includes("Windows"),Windows_CPU:t.toLocaleLowerCase().includes("win64")||t.toLocaleLowerCase().includes("wow64")?"x64":t.toLocaleLowerCase().includes("win32")||t.toLocaleLowerCase().includes("wow32")?"x32":"",Windows_Version:t.includes("Windows NT 6.1")||t.includes("Windows 7")?"Win7":t.includes("Windows NT 6.3")||t.includes("Windows NT 6.2")||t.includes("Windows NT 8")?"Win8":t.includes("Windows NT 10")||t.includes("Windows NT 6.4")?"Win10":"",Mac:t.includes("Macintosh"),Mac_Version:function(){if(t.includes("Macintosh")){var e=t.match(/Mac OS X ([^\s]+)\)/);if(e&&e[1])return e[1].split(/_|\./).join(".")}return""}(),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ios_Version:function(){if(t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)){var e=t.match(/CPU.+OS ([^\s]+) like Mac OS X/);if(e&&e[1])return e[1].split(/_|\./).join(".")}return""}(),Android:t.includes("Android"),Android_Version:(e=t.match(/Android ([^\s]+);/),e&&e[1]?e[1].split(/_|\./).join("."):""),Linux:t.includes("Linux"),HarmonyOS:t.includes("HarmonyOS"),Ubuntu:t.includes("Ubuntu")}}}},function(e,t,n){var r=n(0),s=n(2);e.exports={start:function(e,t){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");var n={pitch:.8,rate:1,volume:1,start:function(){},end:function(){},pause:function(){},resume:function(){},error:function(){}};s.isObject(t)||(t={}),r.isNumber(t.pitch)&&(n.pitch=t.pitch),r.isNumber(t.rate)&&(n.rate=t.rate),r.isNumber(t.volume)&&(n.volume=t.volume),"function"==typeof t.start&&(n.start=t.start),"function"==typeof t.end&&(n.end=t.end),"function"==typeof t.pause&&(n.pause=t.pause),"function"==typeof t.resume&&(n.resume=t.resume),"function"==typeof t.error&&(n.error=t.error);var i=new SpeechSynthesisUtterance;i.text=e,i.pitch=n.pitch,i.rate=n.rate,i.volume=n.volume,i.lang="zh-CN",i.onstart=function(t){n.start.apply(i,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},i.onend=function(t){n.end.apply(i,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},i.onpause=function(t){n.pause.apply(i,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},i.onresume=function(t){n.resume.apply(i,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},i.onerror=function(t){n.error.apply(i,[t,{text:e,pitch:n.pitch,rate:n.rate,volume:n.volume}])},window.speechSynthesis.speak(i)},stop:function(){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");window.speechSynthesis.cancel()},pause:function(){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");window.speechSynthesis.pause()},resume:function(){if(!window.SpeechSynthesisUtterance||!window.speechSynthesis)throw new Error("The current browser does not support this syntax");window.speechSynthesis.resume()}}}]);const i=r(s.exports),o={getAttributes(e){let t={};for(let n of e.attributes)/(^on)|(^style$)|(^class$)/g.test(n.nodeName)||(t[n.nodeName]=n.nodeValue);return t},getStyles(e){let t={};if(e.getAttribute("style")){const n=e.getAttribute("style").split(";").filter((e=>e));for(let e of n){const n=e.split(":"),r=n[0].trim(),s=n[1].trim();t[r]=s}}return t},getUniqueKey(){let e=i.data.get(window,"data-alex-editor-key")||0;return e++,i.data.set(window,"data-alex-editor-key",e),e},flatNodes(e){const t=e=>{let n=[];return e.forEach((e=>{if(i.element.isElement(e,!0)){n.push(e);const r=Array.from(e.childNodes);if(r.length){let e=t(r);n=[...n,...e]}}})),n};return t(e)}},a=class{constructor(e,t,n,r,s){this.key=o.getUniqueKey(),this.type=e,this.parsedom=t,this.marks=n,this.styles=r,this.textContent=s,this.children=null,this.parent=null,this._elm=null}isText(){return"text"==this.type}isBlock(){return"block"==this.type}isInline(){return"inline"==this.type}isClosed(){return"closed"==this.type}isBreak(){return this.isClosed()&&"br"==this.parsedom}isEmpty(){if(this.isText()&&!this.textContent)return!0;if(this.isInline()||this.isBlock()){if(!this.hasChildren())return!0;return this.children.every((e=>!e||e.isEmpty()))}return!1}isSpaceText(){return this.isText()&&!this.isEmpty()&&/^\s+$/g.test(this.textContent)}isRoot(){return!this.parent}isEqual(e){return!!a.isElement(e)&&this.key==e.key}isContains(e){return!!this.isEqual(e)||!e.isRoot()&&this.isContains(e.parent)}isPreStyle(){return!!this.isBlock()&&("pre"==this.parsedom||!!this.hasStyles()&&["pre-wrap","pre"].includes(this.styles["white-space"]))}isOnlyHasBreak(){return!!this.hasChildren()&&this.children.every((e=>e.isBreak()||e.isEmpty()))}hasContains(e){return!!a.isElement(e)&&(this.isContains(e)||e.isContains(this))}hasMarks(){return!!this.marks&&(!!i.common.isObject&&!i.common.isEmptyObject(this.marks))}hasStyles(){return!!this.styles&&(!!i.common.isObject&&!i.common.isEmptyObject(this.styles))}hasChildren(){return!!Array.isArray(this.children)&&!!this.children.length}clone(e=!0){if("boolean"!=typeof e)throw new Error("The parameter must be a Boolean");let t=new a(this.type,this.parsedom,this.marks,this.styles,this.textContent);return e&&this.hasChildren()&&this.children.forEach((n=>{let r=n.clone(e);t.hasChildren()?t.children.push(r):t.children=[r],r.parent=t})),t}convertToBlock(){if(this.isBlock())throw new Error('This element is already of type "block"');let e=this.clone(!0);this.isText()&&(this.textContent=null),this.type="block",this.parsedom=a.paragraph,this.marks=null,this.styles=null,this.children=[e],e.parent=this}setEmpty(){this.isEmpty()||(this.isText()?this.textContent=null:this.isClosed()?(this.type="inline",this.parsedom="span",this.children=null):(this.isBlock()||this.isInline())&&(this.children=null))}getBlock(){return this.isBlock()?this:this.parent.getBlock()}getInline(){return this.isInline()?this:this.isRoot()?null:this.parent.getInline()}_renderElement(){let e=null;if(this.isText())e=document.createTextNode(this.textContent);else{if(e=document.createElement(this.parsedom),this.hasMarks())for(let t in this.marks)e.setAttribute(t,this.marks[t]);if(this.hasStyles())for(let t in this.styles)e.style.setProperty(t,this.styles[t]);if(this.hasChildren())for(let t of this.children){let n=t._renderElement();e.appendChild(n)}}return i.data.set(e,"data-alex-editor-key",this.key),this._elm=e,e}static isElement(e){return e instanceof a}static flatElements(e){const t=e=>{let n=[];return e.forEach((e=>{if(a.isElement(e)&&(n.push(e),e.hasChildren())){let r=t(e.children);n=[...n,...r]}})),n};return t(e)}static getSpaceElement(){let e=document.createElement("span");e.innerHTML="&#xFEFF;";let t=new a("text",null,null,null,e.innerText);return e=null,t}};let l=a;n(l,"paragraph","p");class h{constructor(e,t){this.element=e,this.offset=t,this._init()}_init(){this.element.isText()||this.element.hasChildren()&&(this.element.children[this.offset]?(this.element=this.element.children[this.offset],this.offset=0):(this.element=this.element.children[this.offset-1],this.offset=1))}static isPoint(e){return e instanceof h}isEqual(e){return!!h.isPoint(e)&&(this.element.isEqual(e.element)&&this.offset==e.offset)}moveToEnd(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=e.textContent.length;else if(e.isClosed())this.element=e,this.offset=1;else if(e.hasChildren()){const t=l.flatElements(e.children).filter((e=>!e.isEmpty())),n=t.length;this.moveToEnd(t[n-1])}}moveToStart(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isEmpty())throw new Error("The argument cannot be an empty element");if(e.isText())this.element=e,this.offset=0;else if(e.isClosed())this.element=e,this.offset=0;else if(e.hasChildren()){const t=l.flatElements(e.children).filter((e=>!e.isEmpty()));this.moveToStart(t[0])}}}class c{constructor(e,t){this.anchor=e,this.focus=t}}class u{constructor(){this.records=[],this.current=-1}push(e,t){this.current<this.records.length-1&&(this.records.length=this.current+1);const n=e.map((e=>this._cloneElement(e))),r=l.flatElements(n).find((e=>e.key==t.anchor.element.key)),s=l.flatElements(n).find((e=>e.key==t.focus.element.key)),i=new h(r,t.anchor.offset),o=new h(s,t.focus.offset),a=new c(i,o);this.records.push({stack:n,range:a}),this.current+=1}get(e){if(-1==e){if(this.current<=0)return null;this.current-=1}else if(1==e){if(this.current>=this.records.length-1)return null;this.current+=1}const{stack:t,range:n}=this.records[this.current],r=t.map((e=>this._cloneElement(e))),s=l.flatElements(r).find((e=>e.key==n.anchor.element.key)),i=l.flatElements(r).find((e=>e.key==n.focus.element.key)),o=new h(s,n.anchor.offset),a=new h(i,n.focus.offset);return{stack:r,range:new c(o,a)}}_cloneElement(e){const t=new l(e.type,e.parsedom,e.marks,e.styles,e.textContent);return t.key=e.key,e.hasChildren()&&e.children.forEach((e=>{let n=this._cloneElement(e);t.hasChildren()?t.children.push(n):t.children=[n],n.parent=t})),t}}const{Mac:d}=i.platform.os(),m={Undo:e=>d?90==e.keyCode&&e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.altKey:90==e.keyCode&&e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey,Redo:e=>d?90==e.keyCode&&e.metaKey&&e.shiftKey&&!e.ctrlKey&&!e.altKey:89==e.keyCode&&e.ctrlKey&&!e.metaKey&&!e.shiftKey&&!e.altKey};class f{constructor(e,t){if(n(this,"_formatUnchangeableRules",[e=>(e.parsedom?["br","img","video"].includes(e.parsedom)?(e.type="closed",e.children=null):["span","a","label","code"].includes(e.parsedom)?e.type="inline":["input","textarea","select","script","style","html","body","meta","link","head","title"].includes(e.parsedom)?(e.type="closed",e.parsedom="br",e.children=null):["b","strong"].includes(e.parsedom)?(e.type="inline",e.parsedom="span",i.common.isObject(e.styles)?Object.assign(e.styles,{"font-weight":"bold"}):e.styles={"font-weight":"bold"}):["sup"].includes(e.parsedom)?(e.type="inline",e.parsedom="span",i.common.isObject(e.styles)?Object.assign(e.styles,{"vertical-align":"super"}):e.styles={"vertical-align":"super"}):["sub"].includes(e.parsedom)?(e.type="inline",e.parsedom="span",i.common.isObject(e.styles)?Object.assign(e.styles,{"vertical-align":"sub"}):e.styles={"vertical-align":"sub"}):["i"].includes(e.parsedom)?(e.type="inline",e.parsedom="span",i.common.isObject(e.styles)?Object.assign(e.styles,{"font-style":"italic"}):e.styles={"font-style":"italic"}):["u"].includes(e.parsedom)?(e.type="inline",e.parsedom="span",i.common.isObject(e.styles)?Object.assign(e.styles,{"text-decoration-line":"underline"}):e.styles={"text-decoration-line":"underline"}):["del"].includes(e.parsedom)?(e.type="inline",e.parsedom="span",i.common.isObject(e.styles)?Object.assign(e.styles,{"text-decoration-line":"line-through"}):e.styles={"text-decoration-line":"line-through"}):["pre"].includes(e.parsedom)?e.type="block":["blockquote"].includes(e.parsedom)&&(e.type="block",i.common.isObject(e.styles)?Object.assign(e.styles,{"white-space":"pre-wrap"}):e.styles={"white-space":"pre-wrap"}):e.type="text","function"==typeof this.renderRules&&(e=this.renderRules.apply(this,[e])),e),e=>{if(e.hasChildren()&&e.children.length>1){const t=(e,t)=>{if(e.isBreak()&&t.isBreak())return!0;if(e.isText()&&t.isText())return!0;if(e.isInline()&&t.isInline()){let n=!1;e.hasStyles()&&t.hasStyles()&&i.common.equal(e.styles,t.styles)?n=!0:e.hasStyles()||t.hasStyles()||(n=!0);let r=!1;return e.hasMarks()&&t.hasMarks()&&i.common.equal(e.marks,t.marks)?r=!0:e.hasMarks()||t.hasMarks()||(r=!0),e.parsedom==t.parsedom&&r&&n}return!1},n=(e,n)=>{if(t(e,n)){e.isText()?(this.range&&this.range.anchor.element.isEqual(n)&&(this.range.anchor.element=e,this.range.anchor.offset=e.textContent.length+this.range.anchor.offset),this.range&&this.range.focus.element.isEqual(n)&&(this.range.focus.element=e,this.range.focus.offset=e.textContent.length+this.range.focus.offset),e.textContent+=n.textContent):e.isBreak()?(this.range&&this.range.anchor.element.isEqual(n)&&(this.range.anchor.element=e),this.range&&this.range.focus.element.isEqual(n)&&(this.range.focus.element=e)):e.isInline()&&(e.hasChildren()||(e.children=[]),n.hasChildren()||(n.children=[]),e.children.push(...n.children),e.children.forEach((t=>{t.parent=e})));const t=n.parent.children.findIndex((e=>n.isEqual(e)));n.parent.children.splice(t,1)}};let r=0;for(;r<=e.children.length-2;)t(e.children[r],e.children[r+1])?n(e.children[r],e.children[r+1]):r++}return e},e=>{if(e.hasChildren())if(e.isBlock()){const t=e.children.filter((e=>!e.isEmpty()));let n=t.some((e=>e.isBreak())),r=t.some((e=>!e.isBreak()));n&&r?e.children=e.children.map((e=>(e.isBreak()&&e.setEmpty(),e))):n&&t.length>1&&(e.children=e.children.map(((e,t)=>(e.isBreak()&&t>0&&e.setEmpty(),e))))}else e.isInline()&&e.children.map((e=>{e.isBreak()&&e.setEmpty()}));return e},e=>{if(e.hasChildren()){let t=e.children.some((e=>!e.isEmpty()&&e.isBlock()));t&&e.children.forEach((e=>{e.isEmpty()||e.isBlock()||e.convertToBlock()}))}return e},e=>(e.isEmpty()&&(this.range&&this.range.anchor.element.isEqual(e)&&this.setRecentlyPoint(this.range.anchor),this.range&&this.range.focus.element.isEqual(e)&&this.setRecentlyPoint(this.range.focus)),e)]),"string"==typeof e&&e&&(e=document.body.querySelector(e)),!i.element.isElement(e))throw new Error("You must specify a dom container to initialize the editor");if(i.data.get(e,"data-alex-editor-init"))throw new Error("The element node has been initialized to the editor");i.data.set(e,"data-alex-editor-init",!0),t=this._formatOptions(t),this.$el=e,this.disabled=t.disabled,this.value=t.value,this.renderRules=t.renderRules,this.htmlPaste=t.htmlPaste,this.range=null,this._events={},this._isInputChinese=!1,this._oldValue=t.value,this.stack=this.parseHtml(this.value),this.history=new u,this.formatElementStack(),0==this.stack.length&&this._initStack(),this._initRange(),this.domRender(),this.disabled?this.setDisabled():this.setEnabled(),i.event.on(document,"selectionchange.alex_editor",this._handleSelectionChange.bind(this)),i.event.on(this.$el,"beforeinput.alex_editor",this._handleBeforeInput.bind(this)),i.event.on(this.$el,"compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor",this._handleChineseInput.bind(this)),i.event.on(this.$el,"keydown.alex_editor",this._handleKeydown.bind(this)),i.event.on(this.$el,"cut.alex_editor",this._handleCut.bind(this)),i.event.on(this.$el,"paste.alex_editor",this._handlePaste.bind(this)),i.event.on(this.$el,"drop.alex_editor",this._handleNodesChange.bind(this)),i.event.on(this.$el,"focus.alex_editor",(()=>{this.emit("focus",this.value)})),i.event.on(this.$el,"blur.alex_editor",(()=>{this.emit("blur",this.value)}))}_formatOptions(e){let t={disabled:!1,renderRules:null,htmlPaste:!1,value:"<p><br></p>"};return i.common.isObject(e)&&("boolean"==typeof e.disabled&&(t.disabled=e.disabled),"function"==typeof e.renderRules&&(t.renderRules=e.renderRules),"string"==typeof e.value&&e.value&&(t.value=e.value),"boolean"==typeof e.htmlPaste&&(t.htmlPaste=e.htmlPaste)),t}_initStack(){const e=new l("block",l.paragraph,null,null,null),t=new l("closed","br",null,null,null);this.addElementTo(t,e),this.stack=[e]}_initRange(){const e=this.stack[this.stack.length-1],t=new h(e,0),n=new h(e,0);this.range=new c(t,n),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}_deleteInSameElement(){if(!this.range.anchor.element.isEqual(this.range.focus.element))return;if(0==this.range.anchor.offset&&0==this.range.focus.offset)return;const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.getNextElementOfPoint(this.range.anchor),n=this.range.anchor.element.getBlock(),r=this.range.anchor.element.getInline();if(this.range.anchor.element.isText()){const r=this.range.anchor.element.textContent,s=this.range.anchor.offset==this.range.focus.offset?this.range.anchor.offset-1:this.range.anchor.offset,i=this.range.focus.offset;if(this.range.anchor.element.textContent=r.substring(0,s)+r.substring(i),this.range.anchor.offset==this.range.focus.offset&&(this.range.anchor.offset-=1),this.range.focus.element=this.range.anchor.element,this.range.focus.offset=this.range.anchor.offset,this.range.anchor.element.isEmpty())if(n.isEmpty()){const e=new l("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}else e&&n.isContains(e)?(this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)):t&&n.isContains(t)&&(this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t))}else{const s=this.range.anchor.element.parent.children.findIndex((e=>this.range.anchor.element.isEqual(e)));if(this.range.anchor.element.parent.children.splice(s,1),n.isEmpty())if(this.range.anchor.element.isBreak()&&e)this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e);else{const e=new l("closed","br",null,null,null);this.addElementTo(e,n),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}else{const s=this.range.anchor.element.isBreak();e&&n.isContains(e)?(this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)):t&&n.isContains(t)&&(this.range.anchor.moveToStart(t),this.range.focus.moveToStart(t)),r&&r.isEmpty()&&s&&this.delete()}}}_handleSelectionChange(){if(this.disabled)return;if(this._isInputChinese)return;const e=window.getSelection();if(e.rangeCount){const t=e.getRangeAt(0);if(t.startContainer.isEqualNode(this.$el)||t.endContainer.isEqualNode(this.$el))return;if(i.element.isContains(this.$el,t.startContainer)&&i.element.isContains(this.$el,t.endContainer)){const e=i.data.get(t.startContainer,"data-alex-editor-key"),n=i.data.get(t.endContainer,"data-alex-editor-key"),r=this.getElementByKey(e),s=this.getElementByKey(n),o=new h(r,t.startOffset),a=new h(s,t.endOffset);this.range=new c(o,a)}}}_handleBeforeInput(e){if(!this.disabled&&"insertFromPaste"!=e.inputType&&"deleteByCut"!=e.inputType&&"deleteByDrag"!=e.inputType&&"insertFromDrop"!=e.inputType&&"insertCompositionText"!=e.inputType){if(e.preventDefault(),"insertText"!=e.inputType)return"insertParagraph"==e.inputType||"insertLineBreak"==e.inputType?(this.insertParagraph(),this.formatElementStack(),this.domRender(),void this.setCursor()):"deleteContentBackward"==e.inputType?(this.delete(),this.formatElementStack(),this.domRender(),void this.setCursor()):void 0;e.data&&(this.insertText(e.data),this.formatElementStack(),this.domRender(),this.setCursor())}}_handleChineseInput(e){this.disabled||(e.preventDefault(),"compositionstart"==e.type&&(this._isInputChinese=!0),"compositionend"==e.type&&(this._isInputChinese=!1,e.data&&(this.insertText(e.data),this.formatElementStack(),this.domRender(),this.setCursor())))}_handleKeydown(e){if(!this.disabled)if(m.Undo(e)){e.preventDefault();const t=this.history.get(-1);t&&(this.stack=t.stack,this.range=t.range,this.formatElementStack(),this.domRender(!0),this.setCursor())}else if(m.Redo(e)){e.preventDefault();const t=this.history.get(1);t&&(this.stack=t.stack,this.range=t.range,this.formatElementStack(),this.domRender(!0),this.setCursor())}}_handlePaste(e){if(this.disabled)return;const t=e.clipboardData.files;if(t.length){if(e.preventDefault(),!this.emit("pasteFile",t)){let e=[];Array.from(t).forEach((t=>{t.type&&/^((image\/)|(video\/))/g.test(t.type)&&e.push(i.file.dataFileToBase64(t))})),Promise.all(e).then((e=>{e.forEach(((t,n)=>{let r=null;if(/^(data:video\/)/g.test(t)){r=new l("closed","video",{src:t,autoplay:!0,muted:!0,controls:!0},{width:"auto","max-width":"100%"},null)}else{r=new l("closed","img",{src:t},{width:"auto","max-width":"100%"},null)}this.insertElement(r),this.formatElementStack(),this.domRender(n<e.length-1),this.setCursor()}))}))}}else if(this.htmlPaste){let e=null;const t=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(this.range.focus.offset==t){const t=this.getNextElementOfPoint(this.range.focus);t&&(e=t)}else e=this.range.focus.element;const n=l.flatElements(this.stack),r=n.findIndex((t=>e&&t.isEqual(e))),s=n.length-1-r;setTimeout((()=>{this.stack=this.parseHtml(this.$el.innerHTML),this.formatElementStack();const e=l.flatElements(this.stack);if(r>-1){const t=e.length-1-s;this.range.anchor.moveToStart(e[t]),this.range.focus.moveToStart(e[t]);const n=this.getPreviousElementOfPoint(this.range.anchor);n&&(this.range.anchor.moveToEnd(n),this.range.focus.moveToEnd(n))}else this.range.anchor.moveToEnd(e[e.length-1]),this.range.focus.moveToEnd(e[e.length-1]);this.domRender(),this.setCursor()}),0)}else{e.preventDefault();const t=e.clipboardData.getData("text/plain");t&&(this.insertText(t),this.formatElementStack(),this.domRender(),this.setCursor())}}_handleCut(e){this.disabled||setTimeout((()=>{this.delete(),this.formatElementStack(),this.domRender(),this.setCursor()}),0)}_handleNodesChange(){setTimeout((()=>{this.stack=this.parseHtml(this.$el.innerHTML),this.formatElementStack();const e=l.flatElements(this.stack);this.range.anchor.moveToEnd(e[e.length-1]),this.range.focus.moveToEnd(e[e.length-1]),this.domRender(),this.setCursor()}),0)}setDisabled(){this.disabled=!0,this.$el.removeAttribute("contenteditable")}setEnabled(){this.disabled=!1,this.$el.setAttribute("contenteditable",!0)}formatElement(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");const t=(e,n)=>(e.hasChildren()&&(e.children=e.children.map((e=>t(e,n)))),n(e)),n=e=>(e.hasChildren()&&(e.children.forEach((e=>{e.isEmpty()||(e=n(e))})),e.children=e.children.filter((e=>!e.isEmpty()))),e);return this._formatUnchangeableRules.forEach((n=>{e=t(e,n)})),e=n(e)}formatElementStack(){this.stack=this.stack.map((e=>(e.isBlock()||e.convertToBlock(),e=this.formatElement(e)))).filter((e=>!e.isEmpty()))}domRender(e=!1){this.$el.innerHTML="",this.stack.forEach((e=>{let t=e._renderElement();this.$el.appendChild(t)})),this._oldValue=this.value,this.value=this.$el.innerHTML,this._oldValue!=this.value&&(this.emit("change",this.value,this._oldValue),e||this.history.push(this.stack,this.range))}delete(){if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.range.anchor.element.getBlock();0==this.range.anchor.offset?e&&(t.isContains(e)?(this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),this._deleteInSameElement()):(this.mergeBlockElement(t),this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e))):this._deleteInSameElement()}else if(this.range.anchor.element.isEqual(this.range.focus.element))this._deleteInSameElement();else{const e=l.flatElements(this.stack),t=e.findIndex((e=>this.range.anchor.element.isEqual(e))),n=e.findIndex((e=>this.range.focus.element.isEqual(e)));let r=[];for(let a=t+1;a<n;a++)e[a].hasContains(this.range.anchor.element)||e[a].hasContains(this.range.focus.element)||r.push(e[a]);r.forEach((e=>{if(e.isText())e.textContent="";else if(e.isClosed()){const t=e.parent.children.findIndex((t=>e.isEqual(t)));e.parent.children.splice(t,1)}e.hasChildren()&&(e.children=[])}));const s=this.range.focus.element.getBlock();let i=!s.hasContains(this.range.anchor.element);if(this.range.focus.offset>0){let e=this.range.anchor.element,t=this.range.anchor.offset;this.range.anchor.element=this.range.focus.element,this.range.anchor.offset=0,this._deleteInSameElement(),this.range.anchor.element=e,this.range.anchor.offset=t}const o=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;this.range.anchor.offset<o&&(this.range.focus.element=this.range.anchor.element,this.range.focus.offset=o,this._deleteInSameElement()),i&&this.mergeBlockElement(s)}}insertText(e){if(!e||"string"!=typeof e)throw new Error("The argument must be a string");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.getBlock().isPreStyle()||(e=e.replace(/\s+/g,(()=>{const e=document.createElement("span");return e.innerHTML="&nbsp;",e.innerText}))),this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset)+e+t.substring(this.range.anchor.offset),this.range.anchor.offset=this.range.anchor.offset+e.length,this.range.focus.offset=this.range.anchor.offset}else{const t=new l("text",null,null,null,e);0==this.range.anchor.offset?this.addElementBefore(t,this.range.anchor.element):this.addElementAfter(t,this.range.anchor.element),this.range.anchor.moveToEnd(t),this.range.focus.moveToEnd(t)}else this.delete(),this.insertText(e)}insertParagraph(){if(this.range.anchor.isEqual(this.range.focus)){const e=this.getPreviousElementOfPoint(this.range.anchor),t=this.getNextElementOfPoint(this.range.anchor),n=this.range.anchor.element.getBlock(),r=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(n.isPreStyle())this.range.anchor.offset!=r||t&&n.isContains(t)?this.insertText("\n"):(this.insertText("\n\n"),this.range.anchor.offset-=1,this.range.focus.offset-=1);else if(0!=this.range.anchor.offset||e&&n.isContains(e))if(this.range.anchor.offset!=r||t&&n.isContains(t)){const e=this.range.anchor.element.getBlock(),t=e.clone(!0);this.addElementAfter(t,e),this.range.focus.moveToEnd(e),this.delete();const n=l.flatElements(e.children).findIndex((e=>this.range.anchor.element.isEqual(e))),r=l.flatElements(t.children);this.range.focus.element=r[n],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(t),this.delete()}else{const e=new l("block",n.parsedom,{...n.marks},{...n.styles},null),t=new l("closed","br",null,null,null);this.addElementTo(t,e),this.addElementAfter(e,n),this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e)}else{const e=new l("block",n.parsedom,{...n.marks},{...n.styles},null),t=new l("closed","br",null,null,null);this.addElementTo(t,e),this.addElementBefore(e,n),this.range.anchor.moveToStart(n),this.range.focus.moveToStart(n)}}else this.delete(),this.insertParagraph()}insertElement(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");if(this.range.anchor.isEqual(this.range.focus)){if(e.isBlock()){const t=this.getPreviousElementOfPoint(this.range.anchor),n=this.getNextElementOfPoint(this.range.anchor),r=this.range.anchor.element.getBlock(),s=this.range.anchor.element.isText()?this.range.anchor.element.textContent.length:1;if(r.isOnlyHasBreak())this.addElementBefore(e,r),this.mergeBlockElement(r);else if(0!=this.range.anchor.offset||t&&r.isContains(t))if(this.range.anchor.offset!=s||n&&r.isContains(n)){const t=this.range.anchor.element.getBlock(),n=t.clone(!0);this.addElementAfter(n,t),this.range.focus.moveToEnd(t),this.delete();const r=l.flatElements(t.children).findIndex((e=>this.range.anchor.element.isEqual(e))),s=l.flatElements(n.children);this.range.focus.element=s[r],this.range.focus.offset=this.range.anchor.offset,this.range.anchor.moveToStart(n),this.delete(),this.addElementBefore(e,n)}else this.addElementAfter(e,r);else this.addElementBefore(e,r)}else if(this.range.anchor.element.isText()){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset);let n=new l("text",null,null,null,t.substring(this.range.anchor.offset));this.addElementAfter(n,this.range.anchor.element),this.addElementBefore(e,n)}else 0==this.range.anchor.offset?this.addElementBefore(e,this.range.anchor.element):this.addElementAfter(e,this.range.anchor.element);this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e)}else this.delete(),this.insertElement(e)}setRecentlyPoint(e){const t=this.getPreviousElementOfPoint(e),n=this.getNextElementOfPoint(e),r=e.element.getBlock();t&&r.isContains(t)?e.moveToEnd(t):n&&r.isContains(n)?e.moveToStart(n):t?e.moveToEnd(t):e.moveToStart(n)}getPreviousElement(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isRoot()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t<=0?null:this.stack[t-1].isEmpty()?this.getPreviousElement(this.stack[t-1]):this.stack[t-1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t<=0?null:e.parent.children[t-1].isEmpty()?this.getPreviousElement(e.parent.children[t-1]):e.parent.children[t-1]}}getNextElement(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");if(e.isRoot()){const t=this.stack.findIndex((t=>e.isEqual(t)));return t>=this.stack.length-1?null:this.stack[t+1].isEmpty()?this.getNextElement(this.stack[t+1]):this.stack[t+1]}{const t=e.parent.children.findIndex((t=>e.isEqual(t)));return t>=e.parent.children.length-1?null:e.parent.children[t+1].isEmpty()?this.getNextElement(e.parent.children[t+1]):e.parent.children[t+1]}}addElementTo(e,t,n=0){if(!l.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!l.isElement(t))throw new Error("The second argument must be an AlexElement instance");if("number"!=typeof n||isNaN(n)||n<0)throw new Error("The third argument must be an integer not less than 0");if(t.isClosed()||t.isText())throw new Error('Elements of type "closed" and "text" cannot have children');if(e.isBlock()&&!t.isBlock())throw new Error("A block element cannot be added to an element that is not a block");t.hasChildren()?n>=t.children.length?t.children.push(e):t.children.splice(n,0,e):t.children=[e],e.parent=t}addElementBefore(e,t){if(!l.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!l.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isRoot()){const n=this.stack.findIndex((e=>t.isEqual(e)));this.stack.splice(n,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n)}}addElementAfter(e,t){if(!l.isElement(e))throw new Error("The first argument must be an AlexElement instance");if(!l.isElement(t))throw new Error("The second argument must be an AlexElement instance");if(t.isRoot()){const n=this.stack.findIndex((e=>t.isEqual(e)));n>=this.stack.length-1?this.stack.push(e):this.stack.splice(n+1,0,e),e.parent=null}else{const n=t.parent.children.findIndex((e=>t.isEqual(e)));this.addElementTo(e,t.parent,n+1)}}mergeBlockElement(e){if(!l.isElement(e))throw new Error("The argument must be an AlexElement instance");if(!e.isBlock())throw new Error('Elements that are not "block" cannot be merged');const t=this.getPreviousElement(e);if(t)if(t.children.push(...e.children),t.children.forEach((e=>{e.parent=t})),e.isRoot()){const t=this.stack.findIndex((t=>e.isEqual(t)));this.stack.splice(t,1)}else{const t=e.parent.children.findIndex((t=>e.isEqual(t)));e.parent.children.splice(t,1)}else if(!e.isRoot()){e.parent.children.push(...e.children),e.parent.children.forEach((t=>{t.parent=e.parent}));const t=e.parent.children.findIndex((t=>e.isEqual(t)));e.parent.children.splice(t,1)}}getElementByKey(e){if(!e)throw new Error("You need to specify a key to do the query");const t=n=>{let r=null;for(let s of n){if(s.key==e){r=s;break}if(s.hasChildren()&&(r=t(s.children),r))break}return r};return t(this.stack)}parseNode(e){if(!e)throw new Error("You need to give a node to convert");if(1!=e.nodeType&&3!=e.nodeType)throw new Error("Nodes that are not elements or text cannot be parsed");if(3==e.nodeType)return this.formatElement(new l("text",null,null,null,e.nodeValue));{const t=o.getAttributes(e),n=o.getStyles(e);let r=new l("block",e.nodeName.toLocaleLowerCase(),t,n,null);return Array.from(e.childNodes).forEach((e=>{if(1==e.nodeType||3==e.nodeType){const t=this.parseNode(e);t.parent=r,r.hasChildren()?r.children.push(t):r.children=[t]}})),this.formatElement(r)}}parseHtml(e){if(!e)throw new Error("You need to give an html content to convert");const t=document.createElement("div");t.innerHTML=e;let n=[];return Array.from(t.childNodes).forEach((e=>{const t=this.parseNode(e);n.push(t)})),n}getPreviousElementOfPoint(e){if(!h.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=l.flatElements(this.stack),n=e=>{const r=t.findIndex((t=>e.isEqual(t)));if(r<=0)return null;let s=t[r-1];return!s.isText()&&!s.isClosed()||s.isEmpty()?n(s):s};return n(e.element)}getNextElementOfPoint(e){if(!h.isPoint(e))throw new Error("The argument must be an AlexPoint instance");const t=l.flatElements(this.stack),n=e=>{const r=t.findIndex((t=>e.isEqual(t)));if(r==t.length-1)return null;let s=t[r+1];return!s.isText()&&!s.isClosed()||s.isEmpty()?n(s):s};return n(e.element)}getElementsByRange(){if(this.range.anchor.isEqual(this.range.focus))return[];let e=[];if(this.range.anchor.element.isEqual(this.range.focus.element))if(this.range.anchor.element.isText())if(0==this.range.anchor.offset&&this.range.focus.offset==this.range.anchor.element.textContent.length)e=[this.range.anchor.element];else if(0==this.range.anchor.offset){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.focus.offset);let n=new l("text",null,null,null,t.substring(this.range.focus.offset));this.addElementAfter(n,this.range.anchor.element),e=[this.range.anchor.element]}else if(this.range.focus.offset==this.range.anchor.element.textContent.length){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset);let n=new l("text",null,null,null,t.substring(this.range.anchor.offset));this.addElementAfter(n,this.range.anchor.element),e=[n],this.range.anchor.moveToStart(n),this.range.focus.moveToEnd(n)}else{let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset);let n=new l("text",null,null,null,t.substring(this.range.anchor.offset,this.range.focus.offset));this.addElementAfter(n,this.range.anchor.element);let r=new l("text",null,null,null,t.substring(this.range.focus.offset));this.addElementAfter(r,n),this.range.anchor.moveToStart(n),this.range.focus.moveToEnd(n),e=[n]}else e=[this.range.anchor.element];else{const t=l.flatElements(this.stack),n=t.findIndex((e=>this.range.anchor.element.isEqual(e))),r=t.findIndex((e=>this.range.focus.element.isEqual(e)));for(let s=n+1;s<r;s++)t[s].hasContains(this.range.anchor.element)||t[s].hasContains(this.range.focus.element)||e.push(t[s]);if(this.range.anchor.element.isText()){if(0==this.range.anchor.offset)e.unshift(this.range.anchor.element);else if(this.range.anchor.offset<this.range.anchor.element.textContent.length){let t=this.range.anchor.element.textContent;this.range.anchor.element.textContent=t.substring(0,this.range.anchor.offset);let n=new l("text",null,null,null,t.substring(this.range.anchor.offset));this.addElementAfter(n,this.range.anchor.element),e.unshift(n),this.range.anchor.moveToStart(n)}}else 0==this.range.anchor.offset&&e.unshift(this.range.anchor.element);if(this.range.focus.element.isText()){if(this.range.focus.offset==this.range.focus.element.textContent.length)e.push(this.range.focus.element);else if(this.range.focus.offset>0){let t=this.range.focus.element.textContent;this.range.focus.element.textContent=t.substring(0,this.range.focus.offset);let n=new l("text",null,null,null,t.substring(this.range.focus.offset));this.addElementAfter(n,this.range.focus.element),e.push(this.range.focus.element)}}else 1==this.range.focus.offset&&e.push(this.range.focus.element)}return e}collapseToStart(e){if(!this.disabled)if(l.isElement(e))this.range.anchor.moveToStart(e),this.range.focus.moveToStart(e),this.setCursor();else{const e=l.flatElements(this.stack);this.collapseToStart(e[0])}}collapseToEnd(e){if(!this.disabled)if(l.isElement(e))this.range.anchor.moveToEnd(e),this.range.focus.moveToEnd(e),this.setCursor();else{const e=l.flatElements(this.stack),t=e.length;this.collapseToEnd(e[t-1])}}setCursor(){const e=e=>{let t=null,n=null;if(e.element.isClosed()){t=e.element.parent._elm;const r=e.element.parent.children.findIndex((t=>e.element.isEqual(t)));n=0==e.offset||e.element.isBreak()?r:r+1}else t=e.element._elm,n=e.offset;return{node:t,offset:n}},t=e(this.range.anchor),n=e(this.range.focus),r=window.getSelection();r.removeAllRanges();const s=document.createRange();s.setStart(t.node,t.offset),s.setEnd(n.node,n.offset),r.addRange(s)}setStyle(e){if(!i.common.isObject)throw new Error("The argument must be an object");if(this.range.anchor.isEqual(this.range.focus))if(this.range.anchor.element.isText()){const t=this.range.anchor.element.parent.children.filter((e=>!e.isEmpty()));if(this.range.anchor.element.isSpaceText()&&this.range.anchor.element.parent.isInline()&&1==t.length)this.range.anchor.element.parent.hasStyles()?Object.assign(this.range.anchor.element.parent.styles,e):this.range.anchor.element.parent.styles={...e};else{let t=new l("inline","span",null,{...e},null),n=l.getSpaceElement();this.addElementTo(n,t);let r=this.range.anchor.element.textContent;this.range.anchor.element.textContent=r.substring(0,this.range.anchor.offset);let s=new l("text",null,null,null,r.substring(this.range.anchor.offset));this.addElementAfter(s,this.range.anchor.element),this.addElementBefore(t,s),this.range.anchor.moveToEnd(t),this.range.focus.moveToEnd(t)}}else{let t=new l("inline","span",null,{...e},null),n=l.getSpaceElement();this.addElementTo(n,t),0==this.range.anchor.offset?this.addElementBefore(t,this.range.anchor.element):this.addElementAfter(t,this.range.anchor.element),this.range.anchor.moveToEnd(t),this.range.focus.moveToEnd(t)}else{const t=this.getElementsByRange();t.forEach((t=>{if(t.isText()){if(1==t.parent.children.filter((e=>!e.isEmpty()&&!e.isSpaceText())).length&&t.parent.isInline())t.parent.hasStyles()?Object.assign(t.parent.styles,e):t.parent.styles={...e};else{let n=t.clone();t.type="inline",t.parsedom="span",t.textContent=null;for(let r in e)t.hasStyles()||(t.styles={}),t.styles[r]=e[r];this.addElementTo(n,t)}}else if(t.isClosed())for(let n in e)t.hasStyles()||(t.styles={}),t.styles[n]=e[n]})),this.range.anchor.moveToStart(t[0]),this.range.focus.moveToEnd(t[t.length-1])}}destroy(){this.setDisabled(),i.event.off(document,"selectionchange.alex_editor"),i.event.off(this.$el,"beforeinput.alex_editor compositionstart.alex_editor compositionupdate.alex_editor compositionend.alex_editor keydown.alex_editor cut.alex_editor paste.alex_editor drop.alex_editor focus.alex_editor blur.alex_editor")}emit(e,...t){return"function"==typeof this._events[e]&&(this._events[e].apply(this,[...t]),!0)}on(e,t){this._events[e]=t}}e.AlexEditor=f,e.AlexElement=l,e.default=f,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
